<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cunha Reparos - Sistema de Gest√£o</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 20px;
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            min-height: 100%;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #000;
            border: 2px solid #ffd700;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
        }

        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .header h1 {
            font-size: 1.8rem;
            margin: 15px 0 10px 0;
            font-weight: 600;
        }

        .header p {
            font-size: 1rem;
            margin: 0;
            opacity: 0.8;
            font-weight: 400;
        }

        .header-cards {
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .header-card {
            background: rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            text-align: center;
            position: relative;
            z-index: 11;
        }

        .header-card:hover {
            background: rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .header-card-icon {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .header-card-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #000;
        }

        .tabs {
            display: flex;
            background: #1a1a1a;
            border-bottom: 2px solid #ffd700;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #333;
            color: #ffd700;
            border: none;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            border-right: 1px solid #555;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: #ffd700;
            color: #000;
        }

        .tab:hover:not(.active) {
            background: #444;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            padding: 25px;
        }

        .dashboard-card {
            background: #1a1a1a;
            border: 2px solid #ffd700;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.2);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .card-title {
            color: #ffd700;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .card-value {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-subtitle {
            color: #ccc;
            font-size: 0.9rem;
        }

        .section {
            padding: 20px 25px;
            border-bottom: 1px solid #333;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            color: #ffd700;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .form-group label {
            color: #ffd700;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select, .form-group textarea {
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 6px;
            padding: 10px 12px;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: #0a0a0a;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
        }

        .results-table th {
            background: #ffd700;
            color: #000;
            padding: 12px;
            font-weight: 600;
            font-size: 0.85rem;
            text-align: left;
        }

        .results-table td {
            padding: 12px;
            border-bottom: 1px solid #333;
            color: white;
            font-size: 0.85rem;
        }

        .results-table tr:hover {
            background: #1a1a1a;
        }

        .status-select {
            border: 2px solid #333;
            border-radius: 6px;
            padding: 6px 10px;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .status-select:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
        }

        .status-select:disabled {
            cursor: not-allowed;
            opacity: 0.7;
            background: #333;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            background: #000;
            border: 2px solid #ffd700;
            border-radius: 15px;
            margin: 5% auto;
            padding: 0;
            width: 90%;
            max-width: 600px;
            max-height: 85%;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            background: #ffd700;
            color: #000;
            padding: 20px;
            border-radius: 13px 13px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .close {
            color: #000;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 25px;
            color: white;
        }

        .modal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .modal-form-group {
            display: flex;
            flex-direction: column;
        }

        .modal-form-group label {
            color: #ffd700;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .modal-form-group input, .modal-form-group select {
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 6px;
            padding: 10px 12px;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .modal-form-group input:focus, .modal-form-group select:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }

        .modal-btn-primary {
            background: #ffd700;
            color: #000;
        }

        .modal-btn-primary:hover {
            background: #ffed4e;
            transform: translateY(-1px);
        }

        .modal-btn-secondary {
            background: #333;
            color: #ffd700;
            border: 2px solid #ffd700;
        }

        .modal-btn-secondary:hover {
            background: #ffd700;
            color: #000;
        }

        .footer {
            background: #ffd700;
            color: #000;
            padding: 25px 30px;
            text-align: center;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .footer-item {
            font-weight: 500;
        }

        .footer-slogan {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 15px;
        }

        /* Responsividade Completa */
        @media (max-width: 1200px) {
            .container {
                margin: 0 10px;
            }
            
            .header-cards {
                gap: 10px;
            }
            
            .header-card {
                min-width: 100px;
                padding: 10px 12px;
            }
            
            .header-card-title {
                font-size: 0.75rem;
            }
        }

        @media (max-width: 992px) {
            .logo {
                font-size: 2rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 18px;
            }
            
            .modal-content {
                width: 90%;
                margin: 3% auto;
            }
            
            .modal-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .header {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 15px;
            }
            
            .header-left {
                align-items: center;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .header-left > div:first-child {
                flex-direction: column;
                gap: 10px !important;
            }
            
            .logo {
                font-size: 1.3rem;
            }
            
            .header h1 {
                font-size: 1.3rem;
                margin: 10px 0 8px 0;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .header-cards {
                justify-content: center;
                flex-wrap: wrap;
                width: 100%;
                gap: 8px;
            }
            
            .header-card {
                min-width: 90px;
                padding: 8px 10px;
            }
            
            .header-card-icon {
                font-size: 1rem;
            }
            
            .header-card-title {
                font-size: 0.7rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                padding: 12px 15px;
                border-right: none;
                border-bottom: 1px solid #555;
            }
            
            .tab:last-child {
                border-bottom: none;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
            }
            
            .card-icon {
                font-size: 2rem;
            }
            
            .card-value {
                font-size: 1.5rem;
            }
            
            .section {
                padding: 15px 20px;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
            
            .modal-content {
                width: 95%;
                margin: 2% auto;
                max-height: 95%;
            }
            
            .modal-header {
                padding: 15px;
            }
            
            .modal-header h2 {
                font-size: 1.2rem;
            }
            
            .modal-body {
                padding: 20px 15px;
            }
            
            .modal-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .modal-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .modal-btn {
                width: 100%;
                padding: 15px 20px;
            }
            
            .results-table {
                font-size: 0.8rem;
            }
            
            .results-table th,
            .results-table td {
                padding: 8px;
            }
            
            .footer {
                padding: 20px 15px;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
            }
        }

        @media (max-width: 576px) {
            body {
                padding: 2px;
            }
            
            .container {
                border-radius: 10px;
            }
            
            .header {
                padding: 12px;
            }
            
            .logo {
                font-size: 1.3rem;
            }
            
            .header h1 {
                font-size: 1.1rem;
            }
            
            .header p {
                font-size: 0.8rem;
            }
            
            .header-cards {
                gap: 5px;
            }
            
            .header-card {
                min-width: 80px;
                padding: 6px 8px;
            }
            
            .header-card-title {
                font-size: 0.65rem;
            }
            
            .tab {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            .dashboard-grid {
                padding: 10px;
                gap: 12px;
            }
            
            .dashboard-card {
                padding: 15px;
            }
            
            .card-title {
                font-size: 1rem;
            }
            
            .card-value {
                font-size: 1.3rem;
            }
            
            .card-subtitle {
                font-size: 0.8rem;
            }
            
            .section {
                padding: 12px 15px;
            }
            
            .section-title {
                font-size: 1rem;
            }
            
            .form-group label {
                font-size: 0.8rem;
            }
            
            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 8px 10px;
                font-size: 0.8rem;
            }
            
            .modal-content {
                width: 98%;
                margin: 1% auto;
                max-height: 98%;
            }
            
            .modal-header {
                padding: 12px;
            }
            
            .modal-header h2 {
                font-size: 1rem;
            }
            
            .modal-body {
                padding: 15px 12px;
            }
            
            .modal-form-group label {
                font-size: 0.8rem;
            }
            
            .modal-form-group input,
            .modal-form-group select {
                padding: 8px 10px;
                font-size: 0.8rem;
            }
            
            .results-table {
                font-size: 0.7rem;
            }
            
            .results-table th,
            .results-table td {
                padding: 6px;
            }
            
            .status-select {
                padding: 4px 8px;
                font-size: 0.7rem;
                min-width: 80px;
            }
            
            .footer {
                padding: 15px 12px;
            }
            
            .footer-slogan {
                font-size: 1rem;
            }
        }

        /* Tabelas responsivas */
        @media (max-width: 768px) {
            .results-table,
            .results-table thead,
            .results-table tbody,
            .results-table th,
            .results-table td,
            .results-table tr {
                display: block;
            }
            
            .results-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            .results-table tr {
                border: 1px solid #333;
                margin-bottom: 10px;
                padding: 10px;
                border-radius: 8px;
                background: #0a0a0a;
            }
            
            .results-table td {
                border: none;
                position: relative;
                padding: 8px 8px 8px 35%;
                text-align: left;
            }
            
            .results-table td:before {
                content: attr(data-label) ": ";
                position: absolute;
                left: 8px;
                width: 30%;
                padding-right: 10px;
                white-space: nowrap;
                color: #ffd700;
                font-weight: 600;
                font-size: 0.8rem;
            }
        }

        /* Melhorias para servi√ßos em mobile */
        @media (max-width: 768px) {
            .modal-content table {
                font-size: 0.7rem;
            }
            
            .modal-content table th,
            .modal-content table td {
                padding: 6px 4px;
            }
            
            .modal-content table input,
            .modal-content table select {
                padding: 4px 6px;
                font-size: 0.7rem;
            }
            
            .modal-content table button {
                padding: 4px 8px;
                font-size: 0.8rem;
            }
        }

        /* Notifica√ß√£o responsiva */
        @media (max-width: 576px) {
            #notification {
                top: 10px;
                right: 10px;
                left: 10px;
                padding: 12px 15px;
                font-size: 0.9rem;
                transform: translateY(-100px);
                border-radius: 6px;
                transition: all 0.3s ease, opacity 0.3s ease;
            }
            
            #notification.show {
                transform: translateY(0);
                opacity: 1;
                pointer-events: auto;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container"><!-- Cabe√ßalho -->
   <header class="header">
    <div class="header-left">
     <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
      <div class="logo">
       CUNHA REPAROS
      </div>
      <div style="display: flex; gap: 6px;"><button onclick="exportarDados()" style="background: rgba(0,0,0,0.2); border: 2px solid rgba(0,0,0,0.3); border-radius: 50%; width: 32px; height: 32px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; font-size: 13px;" onmouseover="this.style.background='rgba(0,0,0,0.3)'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='rgba(0,0,0,0.2)'; this.style.transform='scale(1)'" title="Exportar Dados">üì§</button> <button onclick="openModal('importar-dados')" style="background: rgba(0,0,0,0.2); border: 2px solid rgba(0,0,0,0.3); border-radius: 50%; width: 32px; height: 32px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; font-size: 13px;" onmouseover="this.style.background='rgba(0,0,0,0.3)'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='rgba(0,0,0,0.2)'; this.style.transform='scale(1)'" title="Importar Dados">üì•</button>
      </div>
     </div>
     <h1>Sistema de Gest√£o</h1>
     <p>Solu√ß√µes para o seu dia a dia com qualidade e transpar√™ncia</p>
    </div>
    <div class="header-cards">
     <div class="header-card" onclick="openModal('orcamento')" style="cursor: pointer; transition: all 0.3s ease;">
      <div class="header-card-icon">
       üìã
      </div>
      <div class="header-card-title">
       Novo Or√ßamento
      </div>
     </div>
     <div class="header-card" onclick="abrirGerenciadorClientes()">
      <div class="header-card-icon">
       üë§
      </div>
      <div class="header-card-title">
       Gerenciar Clientes
      </div>
     </div>
     <div class="header-card" onclick="openModal('colaborador')">
      <div class="header-card-icon">
       üë•
      </div>
      <div class="header-card-title">
       Cadastrar Colaborador
      </div>
     </div>
     <div class="header-card" onclick="openModal('despesa')">
      <div class="header-card-icon">
       üí∏
      </div>
      <div class="header-card-title">
       Nova Despesa
      </div>
     </div>
    </div>
   </header><!-- Navega√ß√£o por Abas -->
   <div class="tabs"><button class="tab active" onclick="switchTab('home')">‚öôÔ∏è Painel de Controle</button>
   </div><!-- Conte√∫do Principal - Dashboard -->
   <div id="home-content" class="tab-content active">
    <div class="dashboard-grid">
     <div class="dashboard-card" onclick="abrirDetalhesVendas()">
      <div class="card-icon">
       üí∞
      </div>
      <div class="card-title">
       Vendas do M√™s
      </div>
      <div class="card-value" id="vendas-mes">
       R$ 0,00
      </div>
      <div class="card-subtitle">
       0 vendas registradas
      </div>
     </div>
     <div class="dashboard-card" onclick="return">
      <div class="card-icon">
       üìä
      </div>
      <div class="card-title">
       Or√ßamentos do M√™s
      </div>
      <div class="card-value" id="orcamentos-mes">
       2
      </div>
      <div class="card-subtitle">
       1 pendente, 1 rejeitado
      </div>
     </div>
     <div class="dashboard-card" onclick="abrirGerenciadorColaboradores()">
      <div class="card-icon">
       üë•
      </div>
      <div class="card-title">
       Colaboradores
      </div>
      <div class="card-value" id="colaboradores-total">
       2
      </div>
      <div class="card-subtitle">
       2 colaboradores ativos
      </div>
     </div>
     <div class="dashboard-card" onclick="return">
      <div class="card-icon">
       üìà
      </div>
      <div class="card-title">
       Taxa de Convers√£o
      </div>
      <div class="card-value" id="taxa-conversao">
       0%
      </div>
      <div class="card-subtitle">
       Or√ßamentos ‚Üí Vendas
      </div>
     </div>
     <div class="dashboard-card" onclick="abrirGerenciadorDespesas()">
      <div class="card-icon">
       üí∏
      </div>
      <div class="card-title">
       Despesas do M√™s
      </div>
      <div class="card-value" id="despesas-mes">
       R$ 220,00
      </div>
      <div class="card-subtitle" id="despesas-subtitle">
       3 despesas registradas
      </div>
     </div>
     <div class="dashboard-card" onclick="return">
      <div class="card-icon">
       üí∞
      </div>
      <div class="card-title">
       Faturamento L√≠quido
      </div>
      <div class="card-value" style="color: #4CAF50;">
       R$ 4.416,25
      </div>
      <div class="card-subtitle">
       Vendas - Despesas
      </div>
     </div>
    </div><!-- Vendas dos √öltimos 6 Meses -->
    <div class="section">
     <h2 class="section-title">üìä Vendas dos √öltimos 6 Meses</h2>
     <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px;">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">
       <div style="text-align: center; background: #0a0a0a; padding: 15px; border-radius: 8px; border: 1px solid #333;">
        <div style="color: #ffd700; font-weight: 600; margin-bottom: 8px;">
         Mai
        </div>
        <div style="color: white; font-size: 1.2rem; font-weight: 700;" id="vendas-mai">
         R$ 0
        </div>
       </div>
       <div style="text-align: center; background: #0a0a0a; padding: 15px; border-radius: 8px; border: 1px solid #333;">
        <div style="color: #ffd700; font-weight: 600; margin-bottom: 8px;">
         Jun
        </div>
        <div style="color: white; font-size: 1.2rem; font-weight: 700;" id="vendas-jun">
         R$ 0
        </div>
       </div>
       <div style="text-align: center; background: #0a0a0a; padding: 15px; border-radius: 8px; border: 1px solid #333;">
        <div style="color: #ffd700; font-weight: 600; margin-bottom: 8px;">
         Jul
        </div>
        <div style="color: white; font-size: 1.2rem; font-weight: 700;" id="vendas-jul">
         R$ 0
        </div>
       </div>
       <div style="text-align: center; background: #0a0a0a; padding: 15px; border-radius: 8px; border: 1px solid #333;">
        <div style="color: #ffd700; font-weight: 600; margin-bottom: 8px;">
         Ago
        </div>
        <div style="color: white; font-size: 1.2rem; font-weight: 700;" id="vendas-ago">
         R$ 0
        </div>
       </div>
       <div style="text-align: center; background: #0a0a0a; padding: 15px; border-radius: 8px; border: 1px solid #333;">
        <div style="color: #ffd700; font-weight: 600; margin-bottom: 8px;">
         Set
        </div>
        <div style="color: white; font-size: 1.2rem; font-weight: 700;" id="vendas-set">
         R$ 0
        </div>
       </div>
       <div style="text-align: center; background: #0a0a0a; padding: 15px; border-radius: 8px; border: 1px solid #333;">
        <div style="color: #ffd700; font-weight: 600; margin-bottom: 8px;">
         Out
        </div>
        <div style="color: white; font-size: 1.2rem; font-weight: 700;" id="vendas-out">
         R$ 4.636,25
        </div>
       </div>
      </div>
     </div>
    </div><!-- Filtros Inteligentes -->
    <div class="section">
     <h2 class="section-title">üîç Filtro Or√ßamentos</h2>
     <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px;">
      <form id="form-filtros" onsubmit="aplicarFiltros(event)">
       <div style="margin-bottom: 20px;">
        <div class="form-group" style="margin-bottom: 20px;"><label for="filtro-cliente">Cliente:</label> <input type="text" id="filtro-cliente" placeholder="Nome, CPF ou CNPJ do cliente">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
         <div class="form-group"><label for="filtro-periodo">Per√≠odo:</label> <select id="filtro-periodo"> <option value="mes-atual" selected>M√™s Atual</option> <option value="ultimos-30-dias">√öltimos 30 dias</option> <option value="ultimos-90-dias">√öltimos 90 dias</option> <option value="este-ano">Este ano</option> <option value="personalizado">Personalizado</option> </select>
         </div>
         <div class="form-group"><label for="filtro-status">Status:</label> <select id="filtro-status"> <option value="todos" selected>Todos</option> <option value="pendente">Pendente</option> <option value="aprovado">Aprovado</option> <option value="rejeitado">Rejeitado</option> </select>
         </div>
        </div>
       </div>
       <div style="text-align: center;"><button type="submit" style="background: #ffd700; color: #000; border: none; padding: 12px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif; font-size: 1rem; transition: all 0.3s ease;"> üîç Buscar </button> <button type="button" onclick="limparFiltros()" style="background: #333; color: #ffd700; border: 2px solid #ffd700; padding: 12px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif; font-size: 1rem; margin-left: 15px; transition: all 0.3s ease;"> üóëÔ∏è Limpar </button>
       </div>
      </form>
     </div>
    </div><!-- Or√ßamentos e Vendas Recentes -->
    <div class="section">
     <h2 class="section-title">üìã Or√ßamentos e Vendas Recentes</h2>
     <table class="results-table" id="tabela-orcamentos">
      <thead>
       <tr>
        <th>Data</th>
        <th>Cliente</th>
        <th>Tipo</th>
        <th>Valor</th>
        <th>Status</th>
        <th>A√ß√µes</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td data-label="Data">17/10/2024</td>
        <td data-label="Cliente">NATAN PEDRO</td>
        <td data-label="Tipo">Or√ßamento</td>
        <td data-label="Valor">R$ 3.025,00</td>
        <td data-label="Status"><select class="status-select" onchange="alterarStatusOrcamento(this, 0)" style="color: white; border-color: #FF9800; background-color: #FF9800; font-weight: 600;"> <option value="pendente" selected>Pendente</option> <option value="aprovado">Aprovado</option> <option value="rejeitado">Rejeitado</option> </select></td>
        <td data-label="A√ß√µes"><button onclick="verDetalhes('NATAN PEDRO')" style="background: #ffd700; color: #000; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; margin-right: 5px;">üëÅÔ∏è Ver</button> <button onclick="excluirOrcamento(0)" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease;">üóëÔ∏è Excluir</button></td>
       </tr>
       <tr>
        <td data-label="Data">17/10/2024</td>
        <td data-label="Cliente">OTICA SEU FILO 06</td>
        <td data-label="Tipo">Or√ßamento</td>
        <td data-label="Valor">R$ 1.611,25</td>
        <td data-label="Status"><select class="status-select" onchange="alterarStatusOrcamento(this, 1)" style="color: white; border-color: #f44336; background-color: #f44336; font-weight: 600;"> <option value="pendente">Pendente</option> <option value="aprovado">Aprovado</option> <option value="rejeitado" selected>Rejeitado</option> </select></td>
        <td data-label="A√ß√µes"><button onclick="verDetalhes('OTICA SEU FILO 06')" style="background: #ffd700; color: #000; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; margin-right: 5px;">üëÅÔ∏è Ver</button> <button onclick="excluirOrcamento(1)" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease;">üóëÔ∏è Excluir</button></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div><!-- Rodap√© -->
   <footer class="footer">
    <div class="footer-content">
     <div class="footer-item"><strong>Cunha Reparos</strong><br>
       CNPJ: 50.373.624/0001-22
     </div>
     <div class="footer-item">
      üìç Rua C√¢ndido Mariano, 302<br>
       Centro Norte, Cuiab√° ‚Äì MT
     </div>
     <div class="footer-item">
      üìû (65) 9 9820-2236<br>
       ‚úâÔ∏è cunhareparos2021@gmail.com
     </div>
    </div>
    <div class="footer-slogan">
     üü® "Solu√ß√µes para o seu dia a dia."
    </div>
   </footer>
  </div><!-- Modal Novo Or√ßamento -->
  <div id="modal-orcamento" class="modal">
   <div class="modal-content" style="max-width: 1000px; max-height: 90%;">
    <div class="modal-header">
     <h2>üìã Novo Or√ßamento</h2><span class="close" onclick="closeModal('orcamento')">√ó</span>
    </div>
    <div class="modal-body">
     <form id="form-orcamento" onsubmit="criarOrcamento(event)"><!-- Dados do Cliente -->
      <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
       <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üìã Dados do Cliente</h3>
       <div class="modal-form-group" style="margin-bottom: 20px;"><label for="cliente-select">Selecionar Cliente Cadastrado:</label>
        <div style="display: flex; gap: 10px; align-items: center;"><select id="cliente-select" style="flex: 1;" onchange="preencherDadosCliente()"> <option value="">-- Selecione um cliente --</option> </select> <button type="button" onclick="atualizarListaClientes()" style="background: #ffd700; color: #000; border: none; padding: 10px 15px; border-radius: 6px; font-weight: 600; cursor: pointer; white-space: nowrap;">üîÑ Atualizar Lista</button>
        </div>
       </div>
       <div class="modal-grid">
        <div class="modal-form-group"><label for="orcamento-cliente-nome">Raz√£o Social / Nome:</label> <input type="text" id="orcamento-cliente-nome" placeholder="Digite a raz√£o social ou nome" required>
        </div>
        <div class="modal-form-group"><label for="orcamento-cliente-cnpj">CNPJ/CPF:</label> <input type="text" id="orcamento-cliente-cnpj" placeholder="Digite o CNPJ ou CPF" required>
        </div>
        <div class="modal-form-group"><label for="orcamento-cliente-endereco">Endere√ßo:</label> <input type="text" id="orcamento-cliente-endereco" placeholder="Digite o endere√ßo" required>
        </div>
        <div class="modal-form-group"><label for="orcamento-cliente-numero">N¬∞:</label> <input type="text" id="orcamento-cliente-numero" placeholder="Digite o n√∫mero" required>
        </div>
        <div class="modal-form-group"><label for="orcamento-cliente-complemento">Complemento:</label> <input type="text" id="orcamento-cliente-complemento" placeholder="Digite o complemento">
        </div>
        <div class="modal-form-group"><label for="orcamento-cliente-cidade">Cidade:</label> <input type="text" id="orcamento-cliente-cidade" placeholder="Digite a cidade" required>
        </div>
        <div class="modal-form-group"><label for="orcamento-cliente-cep">CEP:</label> <input type="text" id="orcamento-cliente-cep" placeholder="Digite o CEP" required>
        </div>
        <div class="modal-form-group"><label for="orcamento-cliente-telefone">Telefone/WhatsApp:</label> <input type="text" id="orcamento-cliente-telefone" placeholder="Digite o n√∫mero" required>
        </div>
        <div class="modal-form-group"><label for="orcamento-data">Data:</label> <input type="date" id="orcamento-data" required>
        </div>
       </div>
      </div><!-- Servi√ßos -->
      <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
       <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üõ†Ô∏è Servi√ßos</h3>
       <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; background: #0a0a0a; border-radius: 8px; overflow: hidden;">
         <thead>
          <tr style="background: #ffd700; color: #000;">
           <th style="padding: 12px; text-align: left; font-weight: 600; width: 60px;">C√≥d.</th>
           <th style="padding: 12px; text-align: left; font-weight: 600;">Descri√ß√£o do Servi√ßo</th>
           <th style="padding: 12px; text-align: left; font-weight: 600; width: 80px;">Tipo</th>
           <th style="padding: 12px; text-align: left; font-weight: 600; width: 80px;">Qnt/M</th>
           <th style="padding: 12px; text-align: left; font-weight: 600; width: 120px;">Valor Unit√°rio (R$)</th>
           <th style="padding: 12px; text-align: left; font-weight: 600; width: 120px;">Valor Total (R$)</th>
           <th style="padding: 12px; text-align: center; font-weight: 600; width: 50px;">A√ß√£o</th>
          </tr>
         </thead>
         <tbody id="servicos-tbody">
          <tr style="border-bottom: 1px solid #333;">
           <td style="padding: 12px; color: white; text-align: center; font-weight: 600;">1</td>
           <td style="padding: 12px;"><input type="text" placeholder="Digite o nome do servi√ßo" style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;"></td>
           <td style="padding: 12px;"><select style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;"> <option value="QNT">QNT</option> <option value="M¬≤">M¬≤</option> <option value="ML">ML</option> <option value="UN">UN</option> </select></td>
           <td style="padding: 12px;"><input type="number" value="1" min="0" step="0.01" style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;" oninput="calcularTotalServico(this)" onchange="calcularTotalServico(this)" onkeyup="calcularTotalServico(this)"></td>
           <td style="padding: 12px;"><input type="text" placeholder="R$ 0,00" style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;" oninput="formatCurrencyServico(this); calcularTotalServico(this);" onchange="calcularTotalServico(this)" onkeyup="calcularTotalServico(this)"></td>
           <td style="padding: 12px; color: #ffd700; font-weight: 600; text-align: center;" class="valor-total-servico">R$ 0,00</td>
           <td style="padding: 12px; text-align: center;"><button type="button" onclick="removerServico(this)" style="background: #ff4444; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">√ó</button></td>
          </tr>
         </tbody>
        </table>
       </div>
       <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;"><button type="button" onclick="adicionarServico()" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif;">+ Adicionar Servi√ßo</button>
        <div style="text-align: right;">
         <div style="color: #ffd700; font-size: 1.2rem; font-weight: 700; margin-bottom: 5px;">
          Total Geral: <span id="total-geral">R$ 0,00</span>
         </div>
         <div style="color: #4CAF50; font-size: 0.9rem; font-weight: 600;">
          Entrada: <span id="valor-entrada-preview">R$ 0,00</span>
         </div>
         <div style="color: #FF9800; font-size: 0.9rem; font-weight: 600;">
          Saldo: <span id="valor-saldo-preview">R$ 0,00</span>
         </div>
        </div>
       </div>
      </div><!-- Condi√ß√µes Gerais -->
      <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
       <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üìã Condi√ß√µes Gerais</h3>
       <div class="modal-grid">
        <div class="modal-form-group"><label for="prazo-execucao">Prazo de execu√ß√£o:</label> <select id="prazo-execucao"> <option value="at√© 3 dias √∫teis" selected>at√© 3 dias √∫teis</option> <option value="at√© 5 dias √∫teis">at√© 5 dias √∫teis</option> <option value="at√© 7 dias √∫teis">at√© 7 dias √∫teis</option> <option value="at√© 10 dias √∫teis">at√© 10 dias √∫teis</option> <option value="at√© 15 dias √∫teis">at√© 15 dias √∫teis</option> <option value="at√© 20 dias √∫teis">at√© 20 dias √∫teis</option> <option value="at√© 30 dias √∫teis">at√© 30 dias √∫teis</option> <option value="at√© 40 dias √∫teis">at√© 40 dias √∫teis</option> <option value="at√© 50 dias √∫teis">at√© 50 dias √∫teis</option> <option value="at√© 60 dias √∫teis">at√© 60 dias √∫teis</option> <option value="at√© 90 dias √∫teis">at√© 90 dias √∫teis</option> </select>
        </div>
        <div class="modal-form-group"><label for="condicoes-pagamento">Pagamento:</label> <select id="condicoes-pagamento" onchange="atualizarValoresEntrada()"> <option value="30% de entrada" selected>30% de entrada</option> <option value="50% de entrada">50% de entrada</option> <option value="100% √† vista">100% √† vista</option> </select>
        </div>
        <div class="modal-form-group"><label for="validade-orcamento">Validade:</label> <select id="validade-orcamento"> <option value="15 dias ap√≥s emiss√£o">15 dias ap√≥s emiss√£o</option> <option value="20 dias ap√≥s emiss√£o">20 dias ap√≥s emiss√£o</option> <option value="30 dias ap√≥s emiss√£o" selected>30 dias ap√≥s emiss√£o</option> </select>
        </div>
        <div class="modal-form-group"><label for="materiais-inclusos">Materiais:</label> <select id="materiais-inclusos"> <option value="n√£o inclusos">n√£o inclusos</option> <option value="inclusos">inclusos</option> <option value="parcialmente inclusos">parcialmente inclusos</option> </select>
        </div>
       </div>
      </div>
      <div class="modal-buttons"><button type="submit" class="modal-btn modal-btn-primary">üìã Criar Or√ßamento</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('orcamento')">‚ùå Cancelar</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('orcamento')">üö™ Fechar</button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Modal Cadastrar Colaborador -->
  <div id="modal-colaborador" class="modal">
   <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
     <h2>üë• Cadastrar Colaborador</h2><span class="close" onclick="closeModal('colaborador')">√ó</span>
    </div>
    <div class="modal-body">
     <form id="form-colaborador" onsubmit="cadastrarColaborador(event)">
      <div class="modal-grid">
       <div class="modal-form-group"><label for="colaborador-nome">Nome Completo:</label> <input type="text" id="colaborador-nome" placeholder="Digite o nome completo" required>
       </div>
       <div class="modal-form-group"><label for="colaborador-cpf">CPF:</label> <input type="text" id="colaborador-cpf" placeholder="000.000.000-00" required>
       </div>
       <div class="modal-form-group"><label for="colaborador-cargo">Cargo:</label> <select id="colaborador-cargo" required> <option value="">Selecione o cargo</option> <option value="T√©cnico">T√©cnico</option> <option value="Auxiliar">Auxiliar</option> <option value="Administrativo">Administrativo</option> <option value="Gerente">Gerente</option> </select>
       </div>
       <div class="modal-form-group"><label for="colaborador-telefone">Telefone:</label> <input type="text" id="colaborador-telefone" placeholder="(65) 99999-9999" required>
       </div>
       <div class="modal-form-group"><label for="colaborador-email">E-mail:</label> <input type="email" id="colaborador-email" placeholder="email@exemplo.com">
       </div>
       <div class="modal-form-group"><label for="colaborador-endereco">Endere√ßo:</label> <input type="text" id="colaborador-endereco" placeholder="Digite o endere√ßo">
       </div>
      </div>
      <div class="modal-buttons"><button type="submit" class="modal-btn modal-btn-primary">üë• Cadastrar Colaborador</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('colaborador')">‚ùå Cancelar</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('colaborador')">üö™ Fechar</button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Modal Cadastrar Despesa -->
  <div id="modal-despesa" class="modal">
   <div class="modal-content" style="max-width: 500px;">
    <div class="modal-header">
     <h2>üí∏ Cadastrar Despesa</h2><span class="close" onclick="closeModal('despesa')">√ó</span>
    </div>
    <div class="modal-body">
     <form id="form-despesa" onsubmit="cadastrarDespesa(event)">
      <div class="modal-form-group"><label for="despesa-titulo">T√≠tulo da Despesa:</label> <input type="text" id="despesa-titulo" placeholder="Ex: Almo√ßo, Gasolina, Material..." required>
      </div>
      <div class="modal-form-group"><label for="despesa-categoria">Categoria:</label> <select id="despesa-categoria" required> <option value="">Selecione a categoria</option> <option value="Alimenta√ß√£o">Alimenta√ß√£o</option> <option value="Combust√≠vel">Combust√≠vel</option> <option value="M√£o de Obra">M√£o de Obra</option> <option value="Material">Material</option> <option value="Transporte">Transporte</option> <option value="Equipamento">Equipamento</option> <option value="Administrativa">Administrativa</option> <option value="Outros">Outros</option> </select>
      </div>
      <div class="modal-form-group"><label for="despesa-valor">Valor:</label> <input type="text" id="despesa-valor" placeholder="R$ 0,00" oninput="formatCurrency(this)" required>
      </div>
      <div class="modal-form-group"><label for="despesa-data">Data:</label> <input type="date" id="despesa-data" required>
      </div>
      <div class="modal-form-group"><label for="despesa-observacao">Observa√ß√£o (opcional):</label> <input type="text" id="despesa-observacao" placeholder="Detalhes adicionais...">
      </div>
      <div class="modal-buttons"><button type="submit" class="modal-btn modal-btn-primary">üí∏ Cadastrar Despesa</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('despesa')">‚ùå Cancelar</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('despesa')">üö™ Fechar</button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Modal Forma de Pagamento da Entrada -->
  <div id="modal-forma-pagamento-entrada" class="modal">
   <div class="modal-content" style="max-width: 500px;">
    <div class="modal-header">
     <h2>üí≥ Forma de Pagamento da Entrada</h2><span class="close" onclick="closeModal('forma-pagamento-entrada')">√ó</span>
    </div>
    <div class="modal-body">
     <div style="background: #1a1a1a; border: 2px solid #4CAF50; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center;">
      <h3 style="color: #4CAF50; margin-top: 0;">Or√ßamento Aprovado!</h3>
      <div style="margin: 15px 0;">
       <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">
        Cliente:
       </div>
       <div style="font-size: 1.2rem; font-weight: 700; color: white;" id="cliente-entrada-modal">
        --
       </div>
      </div>
      <div style="margin: 15px 0;">
       <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">
        Valor da Entrada:
       </div>
       <div style="font-size: 1.5rem; font-weight: 700; color: #4CAF50;" id="valor-entrada-modal">
        R$ 0,00
       </div>
      </div>
     </div>
     <form id="form-forma-pagamento-entrada" onsubmit="confirmarFormaPagamentoEntrada(event)">
      <div class="modal-form-group"><label for="forma-pagamento-entrada-select">Como o cliente pagou a entrada?</label> <select id="forma-pagamento-entrada-select" required> <option value="">Selecione a forma de pagamento</option> <option value="PIX">PIX</option> <option value="Dinheiro">Dinheiro</option> <option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option> <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option> <option value="Transfer√™ncia Banc√°ria">Transfer√™ncia Banc√°ria</option> <option value="Cheque">Cheque</option> </select>
      </div>
      <div class="modal-form-group"><label for="data-pagamento-entrada-select">Data do Pagamento da Entrada:</label> <input type="date" id="data-pagamento-entrada-select" required>
      </div>
      <div class="modal-buttons"><button type="submit" class="modal-btn modal-btn-primary" style="background: #4CAF50;">‚úÖ Confirmar Aprova√ß√£o</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="cancelarAprovacao()">‚ùå Cancelar Aprova√ß√£o</button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Modal Detalhes do Or√ßamento -->
  <div id="modal-detalhes" class="modal">
   <div class="modal-content" style="max-width: 1000px; max-height: 90%;">
    <div class="modal-header">
     <h2>üìã Detalhes do Or√ßamento</h2><span class="close" onclick="closeModal('detalhes')">√ó</span>
    </div>
    <div class="modal-body">
     <div id="detalhes-content"><!-- Conte√∫do ser√° preenchido dinamicamente -->
     </div>
     <div class="modal-buttons" style="margin-top: 25px;"><button type="button" class="modal-btn modal-btn-primary" onclick="baixarOrcamentoPDF()">üìÑ Baixar PDF</button> <button type="button" class="modal-btn modal-btn-primary" onclick="abrirModalReceberSaldo()" id="btn-receber-saldo" style="background: #4CAF50;">üí∞ Receber Saldo</button> <button type="button" class="modal-btn modal-btn-primary" onclick="abrirModalNotaServico()" style="background: linear-gradient(135deg, #000 0%, #333 100%); border: 2px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); position: relative; overflow: hidden;"> <span style="position: relative; z-index: 2; color: #ffd700; font-weight: 700;">üìã Emitir Nota de Servi√ßo</span>
       <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,215,0,0.2), transparent); transition: left 0.5s; z-index: 1;" onmouseover="this.style.left='100%'" onmouseout="this.style.left='-100%'"></div></button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('detalhes')">üö™ Fechar</button>
     </div>
    </div>
   </div>
  </div><!-- Modal Receber Saldo -->
  <div id="modal-receber-saldo" class="modal">
   <div class="modal-content" style="max-width: 500px;">
    <div class="modal-header">
     <h2>üí∞ Receber Saldo</h2><span class="close" onclick="closeModal('receber-saldo')">√ó</span>
    </div>
    <div class="modal-body">
     <div style="background: #1a1a1a; border: 2px solid #4CAF50; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center;">
      <h3 style="color: #4CAF50; margin-top: 0;">Valor do Saldo</h3>
      <div style="font-size: 2rem; font-weight: 700; color: white; margin: 15px 0;" id="valor-saldo-receber">
       R$ 0,00
      </div>
     </div>
     <form id="form-receber-saldo" onsubmit="confirmarRecebimentoSaldo(event)">
      <div class="modal-form-group"><label for="forma-pagamento-saldo">Forma de Pagamento:</label> <select id="forma-pagamento-saldo" required> <option value="">Selecione a forma de pagamento</option> <option value="PIX">PIX</option> <option value="Dinheiro">Dinheiro</option> <option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option> <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option> <option value="Transfer√™ncia Banc√°ria">Transfer√™ncia Banc√°ria</option> <option value="Cheque">Cheque</option> </select>
      </div>
      <div class="modal-form-group"><label for="data-pagamento-saldo">Data do Pagamento:</label> <input type="date" id="data-pagamento-saldo" required>
      </div>
      <div class="modal-buttons"><button type="submit" class="modal-btn modal-btn-primary" style="background: #4CAF50;">‚úÖ Confirmar Recebimento</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('receber-saldo')">‚ùå Cancelar</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('receber-saldo')">üö™ Fechar</button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Modal Nota de Servi√ßo -->
  <div id="modal-nota-servico" class="modal">
   <div class="modal-content" style="max-width: 900px; max-height: 95%;">
    <div class="modal-header" style="background: linear-gradient(135deg, #000 0%, #333 100%); border: 3px solid #ffd700; position: relative; overflow: hidden;">
     <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns=\" http: www.w3.org 2000 svg\ viewbox="\&quot;0" 0 100 100\>
      <defs>
       <pattern id="\&quot;grid\&quot;" width="\&quot;10\&quot;" height="\&quot;10\&quot;" patternunits="\&quot;userSpaceOnUse\&quot;">
        <path d="\&quot;M" 10 0 l 10\ fill="\&quot;none\&quot;" stroke="\&quot;rgba(255,215,0,0.1)\&quot;" stroke-width="\&quot;0.5\&quot;/"></path>
       </pattern>
      </defs><rect width="\&quot;100\&quot;" height="\&quot;100\&quot;" fill="\&quot;url(%23grid)\&quot;/">
       '); opacity: 0.3;"&gt;
      </rect>
     </div>
     <h2 style="position: relative; z-index: 2; margin: 0; display: flex; align-items: center; gap: 10px; color: #ffd700;"><span style="background: rgba(255,215,0,0.2); padding: 8px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #ffd700;">üìã</span> Nota de Servi√ßo Premium</h2><span class="close" onclick="closeModal('nota-servico')" style="position: relative; z-index: 2; color: #ffd700;">√ó</span>
    </div>
    <div class="modal-body" style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); color: #fff;"><!-- Preview da Nota de Servi√ßo -->
     <div id="preview-nota-servico" style="background: #000; border: 3px solid #ffd700; border-radius: 15px; padding: 30px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2); position: relative; overflow: hidden;"><!-- Marca d'√°gua decorativa -->
      <div style="position: absolute; top: 20px; right: 20px; opacity: 0.1; font-size: 120px; color: #ffd700; transform: rotate(-15deg); z-index: 1; font-weight: bold;">
       üìã
      </div><!-- Cabe√ßalho Premium -->
      <div style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); color: #000; margin: -30px -30px 25px -30px; padding: 25px 30px; position: relative; z-index: 2; border-bottom: 3px solid #000;">
       <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
        <div>
         <h1 style="margin: 0; font-size: 2rem; font-weight: 700; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); color: #000;">CUNHA REPAROS</h1>
         <p style="margin: 5px 0 0 0; font-style: italic; opacity: 0.8; color: #000;">"Solu√ß√µes para o seu dia a dia"</p>
        </div>
        <div style="text-align: right; font-size: 0.9rem; line-height: 1.4; color: #000;">
         <div>
          <strong>CNPJ:</strong> 50.373.624/0001-22
         </div>
         <div>
          <strong>Endere√ßo:</strong> Rua C√¢ndido Mariano, 302
         </div>
         <div>
          Centro Norte, Cuiab√° ‚Äì MT
         </div>
         <div>
          <strong>Tel:</strong> (65) 9 9820-2236
         </div>
        </div>
       </div>
      </div><!-- T√≠tulo da Nota -->
      <div style="text-align: center; margin-bottom: 25px; position: relative; z-index: 2;">
       <div style="background: linear-gradient(135deg, #000 0%, #333 100%); color: #ffd700; padding: 15px 30px; border-radius: 50px; display: inline-block; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3); font-size: 1.3rem; font-weight: 700; letter-spacing: 1px; border: 2px solid #ffd700;">
        üìã NOTA DE SERVI√áO EXECUTADO
       </div>
      </div><!-- Informa√ß√µes da Nota -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px; position: relative; z-index: 2;">
       <div style="background: linear-gradient(135deg, #333 0%, #555 100%); padding: 15px; border-radius: 10px; border-left: 4px solid #ffd700;">
        <div style="color: #ffd700; font-weight: 600; margin-bottom: 5px;">
         üìÖ Data de Emiss√£o
        </div>
        <div style="font-size: 1.1rem; font-weight: 700; color: #fff;" id="data-emissao-nota">
         --
        </div>
       </div>
       <div style="background: linear-gradient(135deg, #333 0%, #555 100%); padding: 15px; border-radius: 10px; border-left: 4px solid #ffd700;">
        <div style="color: #ffd700; font-weight: 600; margin-bottom: 5px;">
         üìã Referente ao Or√ßamento
        </div>
        <div style="font-size: 1.1rem; font-weight: 700; color: #fff;" id="data-orcamento-nota">
         --
        </div>
       </div>
      </div><!-- Dados do Cliente -->
      <div style="background: linear-gradient(135deg, #333 0%, #555 100%); border-radius: 15px; padding: 20px; margin-bottom: 25px; border: 2px solid #ffd700; position: relative; z-index: 2;">
       <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.2rem;"><span style="background: #ffd700; color: #000; padding: 8px; border-radius: 50%; font-size: 1rem;">üë§</span> DADOS DO CLIENTE</h3>
       <div id="dados-cliente-nota" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; font-size: 0.95rem; line-height: 1.6;"><!-- Ser√° preenchido dinamicamente -->
       </div>
      </div><!-- Servi√ßos Executados -->
      <div style="background: linear-gradient(135deg, #333 0%, #555 100%); border-radius: 15px; padding: 20px; margin-bottom: 25px; border: 2px solid #ffd700; position: relative; z-index: 2;">
       <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.2rem;"><span style="background: #ffd700; color: #000; padding: 8px; border-radius: 50%; font-size: 1rem;">üõ†Ô∏è</span> SERVI√áOS EXECUTADOS</h3>
       <div id="servicos-executados-nota" style="overflow-x: auto;"><!-- Ser√° preenchido dinamicamente -->
       </div>
      </div><!-- Resumo Financeiro Premium -->
      <div style="background: linear-gradient(135deg, #333 0%, #555 100%); border-radius: 15px; padding: 25px; margin-bottom: 25px; border: 3px solid #ffd700; position: relative; z-index: 2; box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);">
       <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 1.3rem;"><span style="background: #ffd700; color: #000; padding: 10px; border-radius: 50%; font-size: 1.1rem;">üí∞</span> RESUMO FINANCEIRO COMPLETO</h3>
       <div id="resumo-financeiro-nota"><!-- Ser√° preenchido dinamicamente -->
       </div>
      </div><!-- Status do Servi√ßo -->
      <div id="status-servico-nota" style="text-align: center; padding: 20px; border-radius: 15px; margin-bottom: 25px; position: relative; z-index: 2;"><!-- Ser√° preenchido dinamicamente -->
      </div><!-- Declara√ß√£o e Assinatura -->
      <div style="background: linear-gradient(135deg, #333 0%, #555 100%); border-radius: 15px; padding: 20px; border: 2px solid #ffd700; position: relative; z-index: 2;">
       <h4 style="color: #ffd700; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;"><span style="background: #ffd700; color: #000; padding: 6px; border-radius: 50%; font-size: 0.9rem;">‚úçÔ∏è</span> DECLARA√á√ÉO DE EXECU√á√ÉO</h4>
       <p style="margin-bottom: 15px; line-height: 1.6; color: #fff;">Declaramos que todos os servi√ßos descritos nesta nota foram executados com qualidade e dentro dos prazos estabelecidos. Os materiais utilizados s√£o de primeira qualidade e os servi√ßos foram realizados por profissionais qualificados da CUNHA REPAROS.</p>
       <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
        <div><strong style="color: #ffd700;">Data de Conclus√£o:</strong><br><span id="data-conclusao-nota" style="font-size: 1.1rem; color: #fff;">--</span>
        </div>
        <div><strong style="color: #ffd700;">Respons√°vel T√©cnico:</strong><br><span style="font-size: 1.1rem; color: #fff;">CUNHA REPAROS</span><br><small style="color: #ccc;">CNPJ: 50.373.624/0001-22</small>
        </div>
       </div>
      </div>
     </div><!-- Bot√µes de A√ß√£o -->
     <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;"><button type="button" onclick="baixarNotaServicoPDF()" style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); color: #000; border: 2px solid #000; padding: 15px 30px; border-radius: 25px; font-weight: 700; cursor: pointer; font-size: 1rem; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3); transition: all 0.3s ease; display: flex; align-items: center; gap: 10px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(255, 215, 0, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(255, 215, 0, 0.3)'"> <span style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 50%; font-size: 1.1rem;">üìÑ</span> Baixar Nota </button> <button type="button" onclick="imprimirNotaServico()" style="background: linear-gradient(135deg, #000 0%, #333 100%); color: #ffd700; border: 2px solid #ffd700; padding: 15px 30px; border-radius: 25px; font-weight: 700; cursor: pointer; font-size: 1rem; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); transition: all 0.3s ease; display: flex; align-items: center; gap: 10px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0, 0, 0, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(0, 0, 0, 0.3)'"> <span style="background: rgba(255,215,0,0.2); padding: 8px; border-radius: 50%; font-size: 1.1rem;">üñ®Ô∏è</span> Imprimir Nota </button> <button type="button" onclick="closeModal('nota-servico')" style="background: linear-gradient(135deg, #333 0%, #555 100%); color: #fff; border: 2px solid #666; padding: 15px 30px; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 1rem; box-shadow: 0 5px 15px rgba(51, 51, 51, 0.3); transition: all 0.3s ease; display: flex; align-items: center; gap: 10px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(51, 51, 51, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(51, 51, 51, 0.3)'"> <span style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 50%; font-size: 1.1rem;">üö™</span> Fechar </button>
     </div>
    </div>
   </div>
  </div><!-- Modal Importar Dados -->
  <div id="modal-importar-dados" class="modal">
   <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
     <h2>üì• Importar Dados do Sistema</h2><span class="close" onclick="closeModal('importar-dados')">√ó</span>
    </div>
    <div class="modal-body">
     <div style="background: #1a1a1a; border: 2px solid #4CAF50; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center;">
      <h3 style="color: #4CAF50; margin-top: 0;">üìã Como Importar Seus Dados</h3>
      <div style="text-align: left; color: #fff; line-height: 1.6; margin: 15px 0;">
       <p><strong style="color: #ffd700;">1.</strong> Clique no bot√£o "Escolher Arquivo" abaixo</p>
       <p><strong style="color: #ffd700;">2.</strong> Selecione o arquivo .json que voc√™ exportou anteriormente</p>
       <p><strong style="color: #ffd700;">3.</strong> Clique em "Importar Dados" para carregar todas as informa√ß√µes</p>
       <p><strong style="color: #f44336;">‚ö†Ô∏è Aten√ß√£o:</strong> Esta a√ß√£o ir√° <strong>substituir</strong> todos os dados atuais!</p>
      </div>
     </div>
     <form id="form-importar-dados" onsubmit="importarDados(event)">
      <div class="modal-form-group"><label for="arquivo-importacao">Selecionar Arquivo de Dados (.json):</label> <input type="file" id="arquivo-importacao" accept=".json" required style="background: #1a1a1a; border: 2px solid #333; border-radius: 6px; padding: 10px 12px; color: white; font-family: 'Poppins', sans-serif; font-size: 0.9rem; width: 100%; cursor: pointer;">
      </div>
      <div style="background: #333; border-radius: 8px; padding: 15px; margin: 15px 0;">
       <h4 style="color: #ffd700; margin-top: 0; margin-bottom: 10px;">üìä Dados que ser√£o importados:</h4>
       <ul style="color: #fff; margin: 0; padding-left: 20px;">
        <li>‚úÖ Todos os or√ßamentos e vendas</li>
        <li>‚úÖ Clientes cadastrados</li>
        <li>‚úÖ Colaboradores ativos</li>
        <li>‚úÖ Despesas registradas</li>
        <li>‚úÖ Hist√≥rico completo de transa√ß√µes</li>
       </ul>
      </div>
      <div class="modal-buttons"><button type="submit" class="modal-btn modal-btn-primary" style="background: #4CAF50;">üì• Importar Dados</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('importar-dados')">‚ùå Cancelar</button> <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('importar-dados')">üö™ Fechar</button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Modal Detalhes das Vendas -->
  <div id="modal-vendas" class="modal">
   <div class="modal-content" style="max-width: 1000px; max-height: 90%;">
    <div class="modal-header">
     <h2>üí∞ Detalhes das Vendas do M√™s</h2><span class="close" onclick="closeModal('vendas')">√ó</span>
    </div>
    <div class="modal-body">
     <div style="background: #1a1a1a; border: 2px solid #4CAF50; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center;">
      <h3 style="color: #4CAF50; margin-top: 0;">Resumo Financeiro</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 15px;">
       <div>
        <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">
         Total de Vendas
        </div>
        <div style="font-size: 1.5rem; font-weight: 700; color: white;" id="total-vendas-modal">
         R$ 0,00
        </div>
       </div>
       <div>
        <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">
         Total de Entradas
        </div>
        <div style="font-size: 1.5rem; font-weight: 700; color: #4CAF50;" id="total-entradas-modal">
         R$ 0,00
        </div>
       </div>
       <div>
        <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">
         Total de Saldos
        </div>
        <div style="font-size: 1.5rem; font-weight: 700; color: #FF9800;" id="total-saldos-modal">
         R$ 0,00
        </div>
       </div>
      </div>
     </div>
     <div id="vendas-detalhadas-content"><!-- Conte√∫do ser√° preenchido dinamicamente -->
     </div>
     <div class="modal-buttons" style="margin-top: 25px;"><button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('vendas')">üö™ Fechar</button>
     </div>
    </div>
   </div>
  </div><!-- Notifica√ß√£o -->
  <div id="notification" style="position: fixed; top: 20px; right: 20px; background: #ffd700; color: #000; padding: 15px 20px; border-radius: 8px; font-weight: 600; z-index: 1000; transform: translateX(400px); transition: all 0.3s ease, opacity 0.3s ease; box-shadow: 0 5px 15px rgba(0,0,0,0.3); opacity: 0; pointer-events: none;"></div>
  <script>
        // Arrays para armazenar dados
        let orcamentoAtual = null; // Para controlar qual or√ßamento est√° sendo visualizado
        
        // Vari√°veis globais para controle do modal de forma de pagamento
        let orcamentoAprovandoIndex = null;
        let selectAprovando = null;
        let statusAnterior = null;
        
        let clientes = [
            { 
                nome: 'NATAN PEDRO', 
                cnpj: '40221273840', 
                endereco: 'Rua Otavio Gomes de Castro', 
                numero: '41',
                complemento: '',
                cidade: 'Cuiab√°', 
                cep: '78028-345',
                telefone: '65992187909',
                dataCadastro: '15/10/2024'
            },
            { 
                nome: 'OTICA SEU FILO 06', 
                cnpj: '987.654.321-00', 
                endereco: 'Av. Principal', 
                numero: '456',
                complemento: 'Sala 2',
                cidade: 'Cuiab√°', 
                cep: '78000-000',
                telefone: '(65) 98888-5678',
                dataCadastro: '10/10/2024'
            }
        ];
        
        let colaboradores = [
            { nome: 'JO√ÉO SILVA', cpf: '123.456.789-00', cargo: 'T√©cnico', telefone: '(65) 99999-1234', dataCadastro: '15/10/2024', status: 'Ativo' },
            { nome: 'MARIA SANTOS', cpf: '987.654.321-00', cargo: 'Auxiliar', telefone: '(65) 98888-5678', dataCadastro: '10/10/2024', status: 'Ativo' }
        ];
        
        let despesas = [
            { titulo: 'ALMO√áO / JOAO', categoria: 'Alimenta√ß√£o', valor: 20.00, data: '18/10/2024', observacao: '' },
            { titulo: 'GASOLINA', categoria: 'Combust√≠vel', valor: 100.00, data: '17/10/2024', observacao: 'Abastecimento da van' },
            { titulo: 'JOAO - MAO DE OBRA', categoria: 'M√£o de Obra', valor: 100.00, data: '17/10/2024', observacao: 'Pagamento di√°ria' }
        ];
        
        let orcamentos = [
            { 
                cliente: 'NATAN PEDRO', 
                cnpj: '40221273840',
                endereco: 'Rua Otavio Gomes de Castro, 41',
                cidade: 'Cuiab√° - 78028-345',
                telefone: '65992187909',
                valor: 3025.00, 
                data: '17/10/2024', 
                status: 'pendente', 
                dataAprovacao: null, 
                dataAprovacaoISO: null,
                saldoPago: false, 
                valorEntrada: 907.50, 
                saldoRestante: 2117.50,
                formaPagamentoEntrada: null,
                dataPagamentoEntrada: null,
                formaPagamentoSaldo: null,
                dataPagamentoSaldo: null,
                timestamp: 1729180800000,
                servicos: [
                    { codigo: 1, descricao: 'Instala√ß√£o de sistema el√©trico', tipo: 'UN', quantidade: 1, valorUnitario: 1500.00, valorTotal: 1500.00 },
                    { codigo: 2, descricao: 'Manuten√ß√£o preventiva', tipo: 'QNT', quantidade: 2, valorUnitario: 762.50, valorTotal: 1525.00 }
                ]
            },
            { 
                cliente: 'OTICA SEU FILO 06', 
                cnpj: '987.654.321-00',
                endereco: 'Av. Principal, 456, Sala 2',
                cidade: 'Cuiab√° - 78000-000',
                telefone: '(65) 98888-5678',
                valor: 1611.25, 
                data: '17/10/2024', 
                status: 'rejeitado', 
                dataAprovacao: null, 
                dataAprovacaoISO: null,
                saldoPago: false, 
                valorEntrada: 483.38, 
                saldoRestante: 1127.87,
                formaPagamentoEntrada: null,
                dataPagamentoEntrada: null,
                formaPagamentoSaldo: null,
                dataPagamentoSaldo: null,
                timestamp: 1729177200000,
                servicos: [
                    { codigo: 1, descricao: 'Reparo em equipamento', tipo: 'UN', quantidade: 1, valorUnitario: 1611.25, valorTotal: 1611.25 }
                ]
            }
        ];

        // Fun√ß√£o para alternar entre abas
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            
            if (tabName === 'home') {
                document.getElementById('home-content').classList.add('active');
            }
        }

        // Fun√ß√µes dos Modais
        function openModal(modalName) {
            const modal = document.getElementById(`modal-${modalName}`);
            if (modal) {
                modal.style.display = 'block';
                
                if (modalName === 'orcamento') {
                    const today = new Date();
                    today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
                    document.getElementById('orcamento-data').value = today.toISOString().split('T')[0];
                    atualizarSelectClientes();
                    calcularTotalGeral();
                } else if (modalName === 'despesa') {
                    const today = new Date();
                    today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
                    document.getElementById('despesa-data').value = today.toISOString().split('T')[0];
                }
            }
        }

        function closeModal(modalName) {
            const modal = document.getElementById(`modal-${modalName}`);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Fechar modal clicando fora
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Fun√ß√£o para alterar status do or√ßamento
        function alterarStatusOrcamento(select, index) {
            const orcamento = orcamentos[index];
            
            if (orcamento.saldoPago) {
                showNotification('‚ö†Ô∏è N√£o √© poss√≠vel alterar o status de um or√ßamento quitado!', 'warning');
                select.value = 'aprovado';
                return;
            }
            
            const novoStatus = select.value;
            const statusAnteriorTemp = orcamento.status;
            
            // Se est√° mudando para aprovado e ainda n√£o tem forma de pagamento da entrada
            if (novoStatus === 'aprovado' && !orcamento.formaPagamentoEntrada) {
                // Armazenar informa√ß√µes para o modal
                orcamentoAprovandoIndex = index;
                selectAprovando = select;
                statusAnterior = statusAnteriorTemp;
                
                // Abrir modal para capturar forma de pagamento da entrada
                abrirModalFormaPagamentoEntrada(orcamento);
                return;
            }
            
            // Corrigir problema de fuso hor√°rio
            const hoje = new Date();
            const dataAtualCorrigida = new Date(hoje.getTime() - (hoje.getTimezoneOffset() * 60000));
            const dataAtual = dataAtualCorrigida.toLocaleDateString('pt-BR');
            const dataAtualISO = dataAtualCorrigida.toISOString().split('T')[0];
            
            orcamento.status = novoStatus;
            if (novoStatus === 'aprovado') {
                orcamento.dataAprovacao = dataAtual;
                orcamento.dataAprovacaoISO = dataAtualISO;
            } else {
                orcamento.dataAprovacao = null;
                orcamento.dataAprovacaoISO = null;
                // Limpar informa√ß√µes de pagamento se n√£o aprovado
                orcamento.formaPagamentoEntrada = null;
                orcamento.dataPagamentoEntrada = null;
            }
            
            const statusColors = {
                'pendente': '#FF9800',
                'aprovado': '#4CAF50',
                'rejeitado': '#f44336'
            };
            
            select.style.color = 'white';
            select.style.borderColor = statusColors[novoStatus];
            select.style.backgroundColor = statusColors[novoStatus];
            select.style.fontWeight = '600';
            
            atualizarDashboard();
            atualizarVendasUltimos6Meses(); // For√ßa atualiza√ß√£o do card de vendas
            
            const statusTexto = {
                'pendente': 'Pendente',
                'aprovado': 'Aprovado',
                'rejeitado': 'Rejeitado'
            };
            
            if (novoStatus === 'aprovado') {
                showNotification(`‚úÖ Or√ßamento aprovado para ${orcamento.cliente}!`, 'success');
            }
        }

        // Fun√ß√£o para abrir modal de forma de pagamento da entrada
        function abrirModalFormaPagamentoEntrada(orcamento) {
            // Preencher informa√ß√µes do modal
            document.getElementById('cliente-entrada-modal').textContent = orcamento.cliente;
            document.getElementById('valor-entrada-modal').textContent = 
                (orcamento.valorEntrada || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            // Definir data atual como padr√£o
            const hoje = new Date();
            hoje.setMinutes(hoje.getMinutes() - hoje.getTimezoneOffset());
            document.getElementById('data-pagamento-entrada-select').value = hoje.toISOString().split('T')[0];
            
            openModal('forma-pagamento-entrada');
        }

        // Fun√ß√£o para confirmar forma de pagamento da entrada
        function confirmarFormaPagamentoEntrada(event) {
            event.preventDefault();
            
            if (orcamentoAprovandoIndex === null || !selectAprovando) {
                showNotification('‚ùå Erro: Informa√ß√µes do or√ßamento n√£o encontradas!', 'error');
                return;
            }
            
            const orcamento = orcamentos[orcamentoAprovandoIndex];
            const formaPagamento = document.getElementById('forma-pagamento-entrada-select').value;
            const dataPagamento = document.getElementById('data-pagamento-entrada-select').value;
            
            // Corrigir problema de fuso hor√°rio na data do pagamento
            const dataCorrigida = new Date(dataPagamento + 'T12:00:00');
            const dataPagamentoBR = dataCorrigida.toLocaleDateString('pt-BR');
            
            // Corrigir problema de fuso hor√°rio para data de aprova√ß√£o
            const hoje = new Date();
            const dataAtualCorrigida = new Date(hoje.getTime() - (hoje.getTimezoneOffset() * 60000));
            const dataAtual = dataAtualCorrigida.toLocaleDateString('pt-BR');
            const dataAtualISO = dataAtualCorrigida.toISOString().split('T')[0];
            
            // Atualizar or√ßamento
            orcamento.status = 'aprovado';
            orcamento.dataAprovacao = dataAtual;
            orcamento.dataAprovacaoISO = dataAtualISO;
            orcamento.formaPagamentoEntrada = formaPagamento;
            orcamento.dataPagamentoEntrada = dataPagamentoBR;
            
            // Atualizar visual do select
            const statusColors = {
                'pendente': '#FF9800',
                'aprovado': '#4CAF50',
                'rejeitado': '#f44336'
            };
            
            selectAprovando.value = 'aprovado';
            selectAprovando.style.color = 'white';
            selectAprovando.style.borderColor = statusColors['aprovado'];
            selectAprovando.style.backgroundColor = statusColors['aprovado'];
            selectAprovando.style.fontWeight = '600';
            
            // Atualizar dashboard
            atualizarDashboard();
            atualizarVendasUltimos6Meses(); // For√ßa atualiza√ß√£o do card de vendas
            
            // Fechar modal
            closeModal('forma-pagamento-entrada');
            
            // Limpar vari√°veis globais
            orcamentoAprovandoIndex = null;
            selectAprovando = null;
            statusAnterior = null;
            
            showNotification(`‚úÖ Or√ßamento aprovado para ${orcamento.cliente}! Entrada de ${(orcamento.valorEntrada || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} recebida via ${formaPagamento}.`, 'success');
            
            // Limpar formul√°rio
            document.getElementById('form-forma-pagamento-entrada').reset();
        }

        // Fun√ß√£o para cancelar aprova√ß√£o
        function cancelarAprovacao() {
            if (selectAprovando && statusAnterior !== null) {
                // Voltar ao status anterior
                selectAprovando.value = statusAnterior;
                
                const statusColors = {
                    'pendente': '#FF9800',
                    'aprovado': '#4CAF50',
                    'rejeitado': '#f44336'
                };
                
                selectAprovando.style.color = 'white';
                selectAprovando.style.borderColor = statusColors[statusAnterior];
                selectAprovando.style.backgroundColor = statusColors[statusAnterior];
                selectAprovando.style.fontWeight = '600';
            }
            
            // Fechar modal
            closeModal('forma-pagamento-entrada');
            
            // Limpar vari√°veis globais
            orcamentoAprovandoIndex = null;
            selectAprovando = null;
            statusAnterior = null;
            
            showNotification('‚ùå Aprova√ß√£o cancelada. Status mantido como anterior.', 'info');
            
            // Limpar formul√°rio
            document.getElementById('form-forma-pagamento-entrada').reset();
        }

        // Fun√ß√£o para atualizar dashboard
        function atualizarDashboard() {
            const totalColaboradores = colaboradores.filter(c => c.status === 'Ativo').length;
            document.getElementById('colaboradores-total').textContent = totalColaboradores;
            
            const orcamentosMes = orcamentos.length;
            document.getElementById('orcamentos-mes').textContent = orcamentosMes;
            
            const vendasAprovadas = orcamentos.filter(o => o.status === 'aprovado');
            const totalVendas = vendasAprovadas.reduce((total, venda) => total + venda.valor, 0);
            document.getElementById('vendas-mes').textContent = totalVendas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            const totalDespesas = despesas.reduce((total, despesa) => total + despesa.valor, 0);
            const quantidadeDespesas = despesas.length;
            document.getElementById('despesas-mes').textContent = totalDespesas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            document.getElementById('despesas-subtitle').textContent = `${quantidadeDespesas} despesa${quantidadeDespesas !== 1 ? 's' : ''} registrada${quantidadeDespesas !== 1 ? 's' : ''}`;
            
            const faturamentoLiquido = totalVendas - totalDespesas;
            const faturamentoElement = document.querySelector('.dashboard-card:last-child .card-value');
            faturamentoElement.textContent = faturamentoLiquido.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            faturamentoElement.style.color = faturamentoLiquido >= 0 ? '#4CAF50' : '#f44336';
            
            const taxaConversao = orcamentos.length > 0 ? (vendasAprovadas.length / orcamentos.length * 100).toFixed(0) : 0;
            document.getElementById('taxa-conversao').textContent = `${taxaConversao}%`;
            
            // Atualizar vendas dos √∫ltimos 6 meses
            atualizarVendasUltimos6Meses();
        }

        // Fun√ß√£o para atualizar vendas dos √∫ltimos 6 meses
        function atualizarVendasUltimos6Meses() {
            const hoje = new Date();
            const meses = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
            const nomesMeses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            
            // Calcular os √∫ltimos 6 meses a partir do m√™s atual
            const mesAtual = hoje.getMonth(); // 0-11 (Janeiro = 0)
            const anoAtual = hoje.getFullYear();
            
            const ultimos6Meses = [];
            for (let i = 5; i >= 0; i--) {
                let mes = mesAtual - i;
                let ano = anoAtual;
                
                if (mes < 0) {
                    mes += 12;
                    ano -= 1;
                }
                
                ultimos6Meses.push({
                    mes: mes,
                    ano: ano,
                    nome: nomesMeses[mes],
                    id: meses[mes]
                });
            }
            
            // Calcular vendas para cada m√™s (apenas or√ßamentos aprovados)
            const vendasAprovadas = orcamentos.filter(o => o.status === 'aprovado');
            
            // Sempre recriar o container para garantir atualiza√ß√£o
            const containerMeses = document.querySelector('#home-content .section:nth-child(2) > div > div');
            if (containerMeses) {
                containerMeses.innerHTML = '';
                
                ultimos6Meses.forEach(mesInfo => {
                    const vendasDoMes = vendasAprovadas.filter(venda => {
                        // Usar a data de aprova√ß√£o se dispon√≠vel, sen√£o usar data do or√ßamento
                        let dataParaComparar = venda.data;
                        if (venda.dataAprovacao) {
                            dataParaComparar = venda.dataAprovacao;
                        }
                        
                        const partesData = dataParaComparar.split('/');
                        const dataVenda = new Date(partesData[2], partesData[1] - 1, partesData[0]);
                        
                        return dataVenda.getMonth() === mesInfo.mes && dataVenda.getFullYear() === mesInfo.ano;
                    });
                    
                    const totalMes = vendasDoMes.reduce((total, venda) => total + venda.valor, 0);
                    
                    const mesDiv = document.createElement('div');
                    mesDiv.style.cssText = 'text-align: center; background: #0a0a0a; padding: 15px; border-radius: 8px; border: 1px solid #333;';
                    mesDiv.innerHTML = `
                        <div style="color: #ffd700; font-weight: 600; margin-bottom: 8px;">${mesInfo.nome}</div>
                        <div style="color: ${totalMes > 0 ? '#4CAF50' : 'white'}; font-size: 1.2rem; font-weight: 700;" id="vendas-${mesInfo.id}">
                            ${totalMes > 0 ? totalMes.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) : 'R$ 0'}
                        </div>
                    `;
                    
                    containerMeses.appendChild(mesDiv);
                });
            }
        }

        // Fun√ß√£o para criar or√ßamento
        function criarOrcamento(event) {
            event.preventDefault();
            
            const cliente = document.getElementById('orcamento-cliente-nome').value;
            const cnpj = document.getElementById('orcamento-cliente-cnpj').value;
            const endereco = document.getElementById('orcamento-cliente-endereco').value;
            const numero = document.getElementById('orcamento-cliente-numero').value;
            const complemento = document.getElementById('orcamento-cliente-complemento').value;
            const cidade = document.getElementById('orcamento-cliente-cidade').value;
            const cep = document.getElementById('orcamento-cliente-cep').value;
            const telefone = document.getElementById('orcamento-cliente-telefone').value;
            const totalGeral = document.getElementById('total-geral').textContent;
            const valorNumerico = parseFloat(totalGeral.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
            
            if (valorNumerico <= 0) {
                showNotification('‚ö†Ô∏è Por favor, adicione pelo menos um servi√ßo com valor!', 'warning');
                return;
            }
            
            const tbody = document.getElementById('servicos-tbody');
            let temServicoValido = false;
            
            Array.from(tbody.children).forEach((row) => {
                const descricao = row.children[1].querySelector('input').value.trim();
                const valorUnitarioTexto = row.children[4].querySelector('input').value;
                const valorUnitario = parseFloat(valorUnitarioTexto.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
                
                if (descricao && valorUnitario > 0) {
                    temServicoValido = true;
                }
            });
            
            if (!temServicoValido) {
                showNotification('‚ö†Ô∏è Por favor, preencha pelo menos um servi√ßo com descri√ß√£o e valor!', 'warning');
                return;
            }
            
            const hoje = new Date().toLocaleDateString('pt-BR');
            
            const servicos = [];
            
            Array.from(tbody.children).forEach((row, index) => {
                const descricao = row.children[1].querySelector('input').value.trim();
                const tipo = row.children[2].querySelector('select').value;
                const quantidade = parseFloat(row.children[3].querySelector('input').value) || 0;
                const valorUnitarioTexto = row.children[4].querySelector('input').value;
                const valorUnitario = parseFloat(valorUnitarioTexto.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
                const valorTotal = quantidade * valorUnitario;
                
                if (descricao && valorUnitario > 0) {
                    servicos.push({
                        codigo: servicos.length + 1,
                        descricao: descricao,
                        tipo: tipo,
                        quantidade: quantidade,
                        valorUnitario: valorUnitario,
                        valorTotal: valorTotal
                    });
                }
            });
            
            const prazoExecucao = document.getElementById('prazo-execucao').value;
            const condicoesPagamento = document.getElementById('condicoes-pagamento').value;
            const validadeOrcamento = document.getElementById('validade-orcamento').value;
            const materiaisInclusos = document.getElementById('materiais-inclusos').value;
            
            let percentualEntrada = 0.3;
            
            if (condicoesPagamento === '50% de entrada') {
                percentualEntrada = 0.5;
            } else if (condicoesPagamento === '100% √† vista') {
                percentualEntrada = 1.0;
            }
            
            const valorEntrada = valorNumerico * percentualEntrada;
            const saldoRestante = valorNumerico * (1 - percentualEntrada);
            
            const novoOrcamento = {
                cliente: cliente,
                cnpj: cnpj,
                endereco: `${endereco}, ${numero}${complemento ? ', ' + complemento : ''}`,
                cidade: `${cidade}${cep ? ' - ' + cep : ''}`,
                cep: cep,
                telefone: telefone,
                valor: valorNumerico,
                valorEntrada: valorEntrada,
                saldoRestante: saldoRestante,
                data: hoje,
                status: 'pendente',
                dataAprovacao: null,
                dataAprovacaoISO: null,
                servicos: servicos,
                condicoes: {
                    prazoExecucao: prazoExecucao,
                    condicoesPagamento: condicoesPagamento,
                    validadeOrcamento: validadeOrcamento,
                    materiaisInclusos: materiaisInclusos
                },
                saldoPago: false,
                formaPagamentoEntrada: null,
                dataPagamentoEntrada: null,
                formaPagamentoSaldo: null,
                dataPagamentoSaldo: null,
                timestamp: Date.now()
            };
            
            orcamentos.unshift(novoOrcamento);
            
            const clienteExistente = clientes.find(c => c.nome === cliente);
            if (!clienteExistente) {
                const novoCliente = {
                    nome: cliente,
                    cnpj: cnpj,
                    endereco: endereco,
                    numero: numero,
                    complemento: complemento,
                    cidade: cidade,
                    cep: cep,
                    telefone: telefone,
                    dataCadastro: hoje
                };
                clientes.push(novoCliente);
                atualizarSelectClientes();
            }
            
            atualizarDashboard();
            atualizarTabelaOrcamentos();
            
            showNotification(`‚úÖ Or√ßamento criado para ${cliente}: ${totalGeral} (${servicos.length} servi√ßos)`, 'success');
            closeModal('orcamento');
            
            document.getElementById('form-orcamento').reset();
            resetarTabelaServicos();
        }

        // Fun√ß√£o para cadastrar colaborador
        function cadastrarColaborador(event) {
            event.preventDefault();
            
            const nome = document.getElementById('colaborador-nome').value;
            const cpf = document.getElementById('colaborador-cpf').value;
            const cargo = document.getElementById('colaborador-cargo').value;
            const telefone = document.getElementById('colaborador-telefone').value;
            const email = document.getElementById('colaborador-email').value;
            const endereco = document.getElementById('colaborador-endereco').value;
            
            const hoje = new Date().toLocaleDateString('pt-BR');
            
            const novoColaborador = {
                nome: nome,
                cpf: cpf,
                cargo: cargo,
                telefone: telefone,
                email: email,
                endereco: endereco,
                dataCadastro: hoje,
                status: 'Ativo'
            };
            
            colaboradores.push(novoColaborador);
            atualizarDashboard();
            
            showNotification(`‚úÖ Colaborador ${nome} cadastrado com sucesso!`, 'success');
            closeModal('colaborador');
            
            document.getElementById('form-colaborador').reset();
        }

        // Fun√ß√£o para cadastrar despesa
        function cadastrarDespesa(event) {
            event.preventDefault();
            
            const titulo = document.getElementById('despesa-titulo').value;
            const categoria = document.getElementById('despesa-categoria').value;
            const valorTexto = document.getElementById('despesa-valor').value;
            const valor = parseFloat(valorTexto.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
            const dataISO = document.getElementById('despesa-data').value;
            const observacao = document.getElementById('despesa-observacao').value;
            
            if (valor <= 0) {
                showNotification('‚ö†Ô∏è Por favor, informe um valor v√°lido para a despesa!', 'warning');
                return;
            }
            
            const dataBR = new Date(dataISO).toLocaleDateString('pt-BR');
            
            const novaDespesa = {
                titulo: titulo,
                categoria: categoria,
                valor: valor,
                data: dataBR,
                observacao: observacao || '',
                timestamp: Date.now()
            };
            
            despesas.push(novaDespesa);
            atualizarDashboard();
            
            showNotification(`üí∏ Despesa "${titulo}" cadastrada: ${valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`, 'success');
            closeModal('despesa');
            
            document.getElementById('form-despesa').reset();
        }

        // Fun√ß√£o para atualizar tabela de or√ßamentos
        function atualizarTabelaOrcamentos() {
            const tbody = document.querySelector('.results-table tbody');
            tbody.innerHTML = '';
            
            const orcamentosOrdenados = [...orcamentos].sort((a, b) => {
                if (a.timestamp && b.timestamp) {
                    return b.timestamp - a.timestamp;
                }
                
                if (a.timestamp && !b.timestamp) return -1;
                if (!a.timestamp && b.timestamp) return 1;
                
                const dataA = new Date(a.data.split('/').reverse().join('-'));
                const dataB = new Date(b.data.split('/').reverse().join('-'));
                return dataB - dataA;
            });
            
            orcamentosOrdenados.forEach((orcamento) => {
                const indexOriginal = orcamentos.findIndex(orc => 
                    orc.cliente === orcamento.cliente && 
                    orc.data === orcamento.data && 
                    orc.valor === orcamento.valor
                );
                
                const row = document.createElement('tr');
                const statusColor = orcamento.status === 'aprovado' ? '#4CAF50' : 
                                  orcamento.status === 'rejeitado' ? '#f44336' : '#FF9800';
                
                const selectDisabled = orcamento.saldoPago ? 'disabled' : '';
                const selectStyle = orcamento.saldoPago ? 
                    `color: white; border-color: ${statusColor}; background-color: ${statusColor}; font-weight: 600; opacity: 0.7; cursor: not-allowed;` :
                    `color: white; border-color: ${statusColor}; background-color: ${statusColor}; font-weight: 600;`;
                
                row.innerHTML = `
                    <td data-label="Data">${orcamento.data}</td>
                    <td data-label="Cliente">${orcamento.cliente}</td>
                    <td data-label="Tipo">Or√ßamento</td>
                    <td data-label="Valor">${orcamento.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                    <td data-label="Status">
                        <select class="status-select" onchange="alterarStatusOrcamento(this, ${indexOriginal})" style="${selectStyle}" ${selectDisabled}>
                            <option value="pendente" ${orcamento.status === 'pendente' ? 'selected' : ''}>Pendente</option>
                            <option value="aprovado" ${orcamento.status === 'aprovado' ? 'selected' : ''}>Aprovado</option>
                            <option value="rejeitado" ${orcamento.status === 'rejeitado' ? 'selected' : ''}>Rejeitado</option>
                        </select>
                    </td>
                    <td data-label="A√ß√µes">
                        <button onclick="verDetalhes('${orcamento.cliente}')" style="background: #ffd700; color: #000; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; margin-right: 5px;">üëÅÔ∏è Ver</button>
                        ${(orcamento.status === 'pendente' || orcamento.status === 'rejeitado') ? 
                            `<button onclick="excluirOrcamento(${indexOriginal})" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease;">üóëÔ∏è Excluir</button>` : 
                            ''
                        }
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Fun√ß√£o para ver detalhes
        function verDetalhes(clienteNome) {
            const orcamento = orcamentos.find(orc => orc.cliente === clienteNome);
            
            if (!orcamento) {
                showNotification('‚ùå Or√ßamento n√£o encontrado!', 'error');
                return;
            }
            
            orcamentoAtual = orcamento; // Define o or√ßamento atual
            
            const detalhesContent = document.getElementById('detalhes-content');
            
            const valorEntrada = orcamento.valorEntrada || 0;
            const saldoRestante = orcamento.saldoRestante || 0;
            
            const statusColors = {
                'pendente': { bg: '#FF9800', text: 'Pendente' },
                'aprovado': { bg: '#4CAF50', text: 'Aprovado' },
                'rejeitado': { bg: '#f44336', text: 'Rejeitado' }
            };
            
            const statusInfo = statusColors[orcamento.status] || statusColors.pendente;
            
            detalhesContent.innerHTML = `
                <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <strong style="color: #ffd700;">Cliente:</strong><br>
                            <span style="color: white; font-size: 1.1rem;">${orcamento.cliente}</span>
                        </div>
                        <div>
                            <strong style="color: #ffd700;">Data:</strong><br>
                            <span style="color: white;">${orcamento.data}</span>
                        </div>
                        <div>
                            <strong style="color: #ffd700;">Status:</strong><br>
                            <span style="background: ${statusInfo.bg}; color: white; padding: 4px 12px; border-radius: 6px; font-weight: 600; font-size: 0.9rem;">${statusInfo.text}</span>
                        </div>
                        <div>
                            <strong style="color: #ffd700;">Valor Total:</strong><br>
                            <span style="color: white; font-size: 1.2rem; font-weight: 700;">${orcamento.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
                        </div>
                    </div>
                </div>

                <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üë§ Dados do Cliente</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <strong style="color: #ffd700;">CNPJ/CPF:</strong><br>
                            <span style="color: white;">${orcamento.cnpj || 'N√£o informado'}</span>
                        </div>
                        <div>
                            <strong style="color: #ffd700;">Telefone:</strong><br>
                            <span style="color: white;">${orcamento.telefone || 'N√£o informado'}</span>
                        </div>
                        <div>
                            <strong style="color: #ffd700;">Endere√ßo:</strong><br>
                            <span style="color: white;">${orcamento.endereco || 'N√£o informado'}</span>
                        </div>
                        <div>
                            <strong style="color: #ffd700;">Cidade:</strong><br>
                            <span style="color: white;">${orcamento.cidade || 'N√£o informado'}</span>
                        </div>
                    </div>
                </div>

                ${orcamento.servicos && orcamento.servicos.length > 0 ? `
                <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üõ†Ô∏è Servi√ßos</h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; background: #0a0a0a; border-radius: 8px; overflow: hidden;">
                            <thead>
                                <tr style="background: #ffd700; color: #000;">
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">C√≥d.</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Descri√ß√£o</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Tipo</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Qtd</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Valor Unit.</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${orcamento.servicos.map(servico => `
                                    <tr style="border-bottom: 1px solid #333;">
                                        <td style="padding: 12px; color: white; text-align: center;">${servico.codigo}</td>
                                        <td style="padding: 12px; color: white;">${servico.descricao}</td>
                                        <td style="padding: 12px; color: white; text-align: center;">${servico.tipo}</td>
                                        <td style="padding: 12px; color: white; text-align: center;">${servico.quantidade}</td>
                                        <td style="padding: 12px; color: white; text-align: right;">${servico.valorUnitario.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                        <td style="padding: 12px; color: #ffd700; font-weight: 600; text-align: right;">${servico.valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                ` : ''}

                <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üí≥ Condi√ß√µes de Pagamento</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <strong style="color: #ffd700;">Entrada:</strong><br>
                            <span style="color: #4CAF50; font-size: 1.1rem; font-weight: 600;">${valorEntrada.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
                            ${orcamento.formaPagamentoEntrada ? `<br><small style="color: #ccc;">Pago via ${orcamento.formaPagamentoEntrada}</small>` : ''}
                            ${orcamento.dataPagamentoEntrada ? `<br><small style="color: #ccc;">em ${orcamento.dataPagamentoEntrada}</small>` : ''}
                        </div>
                        <div>
                            <strong style="color: #ffd700;">Saldo Restante:</strong><br>
                            <span style="color: ${orcamento.saldoPago ? '#4CAF50' : '#FF9800'}; font-size: 1.1rem; font-weight: 600;">${saldoRestante.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
                            ${orcamento.saldoPago ? `<br><small style="color: #4CAF50;">‚úÖ PAGO</small>` : `<br><small style="color: #FF9800;">‚è≥ PENDENTE</small>`}
                            ${orcamento.formaPagamentoSaldo ? `<br><small style="color: #ccc;">Pago via ${orcamento.formaPagamentoSaldo} em ${orcamento.dataPagamentoSaldo}</small>` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            openModal('detalhes');
            
            // Atualizar bot√µes do modal de detalhes
            const modalButtons = document.querySelector('#modal-detalhes .modal-buttons');
            
            // Definir bot√µes baseado no status do or√ßamento
            let botoesHTML = '';
            
            // Bot√£o de baixar PDF sempre dispon√≠vel
            botoesHTML += '<button type="button" class="modal-btn modal-btn-primary" onclick="baixarOrcamentoPDF()">üìÑ Baixar PDF</button>';
            
            // Bot√£o de receber saldo apenas se aprovado e n√£o pago
            if (orcamento.status === 'aprovado' && !orcamento.saldoPago) {
                botoesHTML += '<button type="button" class="modal-btn modal-btn-primary" onclick="abrirModalReceberSaldo()" style="background: #4CAF50;">üí∞ Receber Saldo</button>';
            }
            
            // Bot√£o de emitir nota fiscal apenas se aprovado
            if (orcamento.status === 'aprovado') {
                botoesHTML += '<button type="button" class="modal-btn modal-btn-primary" onclick="abrirModalNotaServico()" style="background: linear-gradient(135deg, #000 0%, #333 100%); border: 2px solid #ffd700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); position: relative; overflow: hidden;"><span style="position: relative; z-index: 2; color: #ffd700; font-weight: 700;">üìã Emitir Nota de Servi√ßo</span><div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,215,0,0.2), transparent); transition: left 0.5s; z-index: 1;" onmouseover="this.style.left=\'100%\'" onmouseout="this.style.left=\'-100%\'"></div></button>';
            }
            
            // Bot√£o fechar sempre dispon√≠vel
            botoesHTML += '<button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal(\'detalhes\')">üö™ Fechar</button>';
            
            modalButtons.innerHTML = botoesHTML;
        }

        // Fun√ß√µes auxiliares
        function formatCurrency(input) {
            let value = input.value.replace(/\D/g, '');
            value = (value / 100).toFixed(2) + '';
            value = value.replace(".", ",");
            value = value.replace(/(\d)(\d{3})(\d{3}),/g, "$1.$2.$3,");
            value = value.replace(/(\d)(\d{3}),/g, "$1.$2,");
            input.value = "R$ " + value;
        }

        function formatCurrencyServico(input) {
            let value = input.value.replace(/\D/g, '');
            if (value === '') {
                input.value = '';
                return;
            }
            value = (value / 100).toFixed(2) + '';
            value = value.replace(".", ",");
            value = value.replace(/(\d)(\d{3})(\d{3}),/g, "$1.$2.$3,");
            value = value.replace(/(\d)(\d{3}),/g, "$1.$2,");
            input.value = "R$ " + value;
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            
            const colors = {
                'success': '#4CAF50',
                'error': '#f44336',
                'warning': '#FF9800',
                'info': '#ffd700'
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.style.color = type === 'info' ? '#000' : '#fff';
            notification.textContent = message;
            
            // Limpar qualquer timeout anterior
            if (notification.timeoutId) {
                clearTimeout(notification.timeoutId);
            }
            
            // Verificar se √© mobile para usar anima√ß√£o diferente
            const isMobile = window.innerWidth <= 576;
            
            if (isMobile) {
                notification.classList.add('show');
                notification.style.transform = 'translateY(0)';
                notification.style.opacity = '1';
                
                notification.timeoutId = setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(-100px)';
                    setTimeout(() => {
                        notification.classList.remove('show');
                        notification.style.transform = 'translateY(-100px)';
                        notification.style.opacity = '0';
                    }, 300);
                }, 5000);
            } else {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
                
                notification.timeoutId = setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(400px)';
                    setTimeout(() => {
                        notification.style.transform = 'translateX(400px)';
                        notification.style.opacity = '0';
                    }, 300);
                }, 5000);
            }
        }

        // Fun√ß√µes de gerenciamento de servi√ßos
        function calcularTotalServico(element) {
            const row = element.closest('tr');
            const quantidade = parseFloat(row.children[3].querySelector('input').value) || 0;
            const valorUnitarioTexto = row.children[4].querySelector('input').value;
            const valorUnitario = parseFloat(valorUnitarioTexto.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
            const valorTotal = quantidade * valorUnitario;
            
            row.children[5].textContent = valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            // Pequeno delay para garantir que o valor foi atualizado
            setTimeout(() => {
                calcularTotalGeral();
            }, 10);
        }

        function calcularTotalGeral() {
            const tbody = document.getElementById('servicos-tbody');
            let totalGeral = 0;
            
            Array.from(tbody.children).forEach((row) => {
                const valorTotalTexto = row.children[5].textContent;
                const valorTotal = parseFloat(valorTotalTexto.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
                totalGeral += valorTotal;
            });
            
            document.getElementById('total-geral').textContent = totalGeral.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            atualizarValoresEntrada();
        }

        function atualizarValoresEntrada() {
            const totalGeralTexto = document.getElementById('total-geral').textContent;
            const totalGeral = parseFloat(totalGeralTexto.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
            const condicoesPagamento = document.getElementById('condicoes-pagamento').value;
            
            let percentualEntrada = 0.3;
            
            if (condicoesPagamento === '50% de entrada') {
                percentualEntrada = 0.5;
            } else if (condicoesPagamento === '100% √† vista') {
                percentualEntrada = 1.0;
            }
            
            const valorEntrada = totalGeral * percentualEntrada;
            const saldoRestante = totalGeral * (1 - percentualEntrada);
            
            document.getElementById('valor-entrada-preview').textContent = valorEntrada.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            document.getElementById('valor-saldo-preview').textContent = saldoRestante.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function adicionarServico() {
            const tbody = document.getElementById('servicos-tbody');
            const novoNumero = tbody.children.length + 1;
            
            const novaLinha = document.createElement('tr');
            novaLinha.style.borderBottom = '1px solid #333';
            novaLinha.innerHTML = `
                <td style="padding: 12px; color: white; text-align: center; font-weight: 600;">${novoNumero}</td>
                <td style="padding: 12px;">
                    <input type="text" placeholder="Digite o nome do servi√ßo" style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;">
                </td>
                <td style="padding: 12px;">
                    <select style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;">
                        <option value="QNT">QNT</option>
                        <option value="M¬≤">M¬≤</option>
                        <option value="ML">ML</option>
                        <option value="UN">UN</option>
                    </select>
                </td>
                <td style="padding: 12px;">
                    <input type="number" value="1" min="0" step="0.01" style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;" oninput="calcularTotalServico(this)" onchange="calcularTotalServico(this)" onkeyup="calcularTotalServico(this)">
                </td>
                <td style="padding: 12px;">
                    <input type="text" placeholder="R$ 0,00" style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;" oninput="formatCurrencyServico(this); calcularTotalServico(this);" onchange="calcularTotalServico(this)" onkeyup="calcularTotalServico(this)">
                </td>
                <td style="padding: 12px; color: #ffd700; font-weight: 600; text-align: center;" class="valor-total-servico">R$ 0,00</td>
                <td style="padding: 12px; text-align: center;">
                    <button type="button" onclick="removerServico(this)" style="background: #ff4444; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">√ó</button>
                </td>
            `;
            
            tbody.appendChild(novaLinha);
        }

        function removerServico(button) {
            const row = button.closest('tr');
            const tbody = row.parentNode;
            
            if (tbody.children.length <= 1) {
                showNotification('‚ö†Ô∏è Deve haver pelo menos um servi√ßo!', 'warning');
                return;
            }
            
            row.remove();
            
            Array.from(tbody.children).forEach((row, index) => {
                row.children[0].textContent = index + 1;
            });
            
            calcularTotalGeral();
        }

        function resetarTabelaServicos() {
            const tbody = document.getElementById('servicos-tbody');
            tbody.innerHTML = `
                <tr style="border-bottom: 1px solid #333;">
                    <td style="padding: 12px; color: white; text-align: center; font-weight: 600;">1</td>
                    <td style="padding: 12px;">
                        <input type="text" placeholder="Digite o nome do servi√ßo" style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;">
                    </td>
                    <td style="padding: 12px;">
                        <select style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;">
                            <option value="QNT">QNT</option>
                            <option value="M¬≤">M¬≤</option>
                            <option value="ML">ML</option>
                            <option value="UN">UN</option>
                        </select>
                    </td>
                    <td style="padding: 12px;">
                        <input type="number" value="1" min="0" step="0.01" style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;" oninput="calcularTotalServico(this)" onchange="calcularTotalServico(this)" onkeyup="calcularTotalServico(this)">
                    </td>
                    <td style="padding: 12px;">
                        <input type="text" placeholder="R$ 0,00" style="width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 8px; color: white; font-family: 'Poppins', sans-serif;" oninput="formatCurrencyServico(this); calcularTotalServico(this);" onchange="calcularTotalServico(this)" onkeyup="calcularTotalServico(this)">
                    </td>
                    <td style="padding: 12px; color: #ffd700; font-weight: 600; text-align: center;" class="valor-total-servico">R$ 0,00</td>
                    <td style="padding: 12px; text-align: center;">
                        <button type="button" onclick="removerServico(this)" style="background: #ff4444; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">√ó</button>
                    </td>
                </tr>
            `;
            
            calcularTotalGeral();
        }

        // Fun√ß√µes de gerenciamento
        function abrirGerenciadorClientes() {
            const clientesContent = `
                <div style="background: #1a1a1a; border: 2px solid #4CAF50; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center;">
                    <h3 style="color: #4CAF50; margin-top: 0;">Gerenciamento de Clientes</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 15px;">
                        <div>
                            <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">Total de Clientes</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: white;">${clientes.length}</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">Clientes Ativos</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #4CAF50;">${clientes.length}</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px;">
                    <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üìã Lista de Clientes</h3>
                    
                    ${clientes.length === 0 ? 
                        '<div style="text-align: center; color: #ccc; padding: 40px;">Nenhum cliente cadastrado</div>' :
                        `<div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; background: #0a0a0a; border-radius: 8px; overflow: hidden;">
                                <thead>
                                    <tr style="background: #ffd700; color: #000;">
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Nome/Raz√£o Social</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">CNPJ/CPF</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Telefone</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Cidade</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Data Cadastro</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 600;">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${clientes.map((cliente, index) => `
                                        <tr style="border-bottom: 1px solid #333;" id="cliente-row-${index}">
                                            <td style="padding: 12px; color: white; font-weight: 600;">${cliente.nome}</td>
                                            <td style="padding: 12px; color: white;">${cliente.cnpj}</td>
                                            <td style="padding: 12px; color: white;">${cliente.telefone}</td>
                                            <td style="padding: 12px; color: white;">${cliente.cidade}</td>
                                            <td style="padding: 12px; color: white;">${cliente.dataCadastro}</td>
                                            <td style="padding: 12px; text-align: center;">
                                                <button onclick="excluirCliente(${index})" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#d32f2f'" onmouseout="this.style.background='#f44336'">
                                                    üóëÔ∏è Excluir
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>`
                    }
                </div>
            `;
            
            document.getElementById('detalhes-content').innerHTML = clientesContent;
            openModal('detalhes');
            
            // Atualizar t√≠tulo do modal
            document.querySelector('#modal-detalhes .modal-header h2').textContent = 'üë§ Gerenciar Clientes';
            
            // Esconder bot√µes desnecess√°rios
            const modalButtons = document.querySelector('#modal-detalhes .modal-buttons');
            modalButtons.innerHTML = `
                <button type="button" class="modal-btn modal-btn-primary" onclick="openModal('orcamento'); closeModal('detalhes');">‚ûï Novo Cliente</button>
                <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('detalhes')">üö™ Fechar</button>
            `;
        }

        function abrirGerenciadorColaboradores() {
            const colaboradoresAtivos = colaboradores.filter(c => c.status === 'Ativo');
            
            const colaboradoresContent = `
                <div style="background: #1a1a1a; border: 2px solid #4CAF50; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center;">
                    <h3 style="color: #4CAF50; margin-top: 0;">Gerenciamento de Colaboradores</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 15px;">
                        <div>
                            <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">Total de Colaboradores</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: white;">${colaboradores.length}</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">Colaboradores Ativos</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #4CAF50;">${colaboradoresAtivos.length}</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px;">
                    <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üë• Lista de Colaboradores</h3>
                    
                    ${colaboradores.length === 0 ? 
                        '<div style="text-align: center; color: #ccc; padding: 40px;">Nenhum colaborador cadastrado</div>' :
                        `<div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; background: #0a0a0a; border-radius: 8px; overflow: hidden;">
                                <thead>
                                    <tr style="background: #ffd700; color: #000;">
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Nome Completo</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">CPF</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Cargo</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Telefone</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Data Cadastro</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 600;">Status</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 600;">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${colaboradores.map((colaborador, index) => `
                                        <tr style="border-bottom: 1px solid #333; ${colaborador.status !== 'Ativo' ? 'opacity: 0.6;' : ''}" id="colaborador-row-${index}">
                                            <td style="padding: 12px; color: white; font-weight: 600;">${colaborador.nome}</td>
                                            <td style="padding: 12px; color: white;">${colaborador.cpf}</td>
                                            <td style="padding: 12px; color: white;">${colaborador.cargo}</td>
                                            <td style="padding: 12px; color: white;">${colaborador.telefone}</td>
                                            <td style="padding: 12px; color: white;">${colaborador.dataCadastro}</td>
                                            <td style="padding: 12px; text-align: center;">
                                                <span style="background: ${colaborador.status === 'Ativo' ? '#4CAF50' : '#f44336'}; color: white; padding: 4px 12px; border-radius: 6px; font-weight: 600; font-size: 0.8rem;">
                                                    ${colaborador.status}
                                                </span>
                                            </td>
                                            <td style="padding: 12px; text-align: center;">
                                                <button onclick="excluirColaborador(${index})" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#d32f2f'" onmouseout="this.style.background='#f44336'">
                                                    üóëÔ∏è Excluir
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>`
                    }
                </div>
            `;
            
            document.getElementById('detalhes-content').innerHTML = colaboradoresContent;
            openModal('detalhes');
            
            // Atualizar t√≠tulo do modal
            document.querySelector('#modal-detalhes .modal-header h2').textContent = 'üë• Gerenciar Colaboradores';
            
            // Atualizar bot√µes do modal
            const modalButtons = document.querySelector('#modal-detalhes .modal-buttons');
            modalButtons.innerHTML = `
                <button type="button" class="modal-btn modal-btn-primary" onclick="openModal('colaborador'); closeModal('detalhes');">‚ûï Novo Colaborador</button>
                <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('detalhes')">üö™ Fechar</button>
            `;
        }

        function abrirGerenciadorDespesas() {
            const totalDespesas = despesas.reduce((total, despesa) => total + despesa.valor, 0);
            const quantidadeDespesas = despesas.length;
            
            const despesasContent = `
                <div style="background: #1a1a1a; border: 2px solid #f44336; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center;">
                    <h3 style="color: #f44336; margin-top: 0;">Gerenciamento de Despesas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 15px;">
                        <div>
                            <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">Total de Despesas</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: white;">${quantidadeDespesas}</div>
                        </div>
                        <div>
                            <div style="color: #ffd700; font-size: 0.9rem; margin-bottom: 5px;">Valor Total</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #f44336;">${totalDespesas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px;">
                    <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üí∏ Lista de Despesas</h3>
                    
                    ${despesas.length === 0 ? 
                        '<div style="text-align: center; color: #ccc; padding: 40px;">Nenhuma despesa cadastrada</div>' :
                        `<div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; background: #0a0a0a; border-radius: 8px; overflow: hidden;">
                                <thead>
                                    <tr style="background: #ffd700; color: #000;">
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">T√≠tulo</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Categoria</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Valor</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Data</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Observa√ß√£o</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 600;">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${despesas.map((despesa, index) => `
                                        <tr style="border-bottom: 1px solid #333;" id="despesa-row-${index}">
                                            <td style="padding: 12px; color: white; font-weight: 600;">${despesa.titulo}</td>
                                            <td style="padding: 12px; color: white;">${despesa.categoria}</td>
                                            <td style="padding: 12px; color: #f44336; font-weight: 600;">${despesa.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                            <td style="padding: 12px; color: white;">${despesa.data}</td>
                                            <td style="padding: 12px; color: white;">${despesa.observacao || '-'}</td>
                                            <td style="padding: 12px; text-align: center;">
                                                <button onclick="excluirDespesa(${index})" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#d32f2f'" onmouseout="this.style.background='#f44336'">
                                                    üóëÔ∏è Excluir
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>`
                    }
                </div>
            `;
            
            document.getElementById('detalhes-content').innerHTML = despesasContent;
            openModal('detalhes');
            
            // Atualizar t√≠tulo do modal
            document.querySelector('#modal-detalhes .modal-header h2').textContent = 'üí∏ Gerenciar Despesas';
            
            // Atualizar bot√µes do modal
            const modalButtons = document.querySelector('#modal-detalhes .modal-buttons');
            modalButtons.innerHTML = `
                <button type="button" class="modal-btn modal-btn-primary" onclick="openModal('despesa'); closeModal('detalhes');">‚ûï Nova Despesa</button>
                <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('detalhes')">üö™ Fechar</button>
            `;
        }

        // Fun√ß√µes de exclus√£o
        function excluirOrcamento(index) {
            const orcamento = orcamentos[index];
            if (!orcamento) {
                showNotification('‚ùå Or√ßamento n√£o encontrado!', 'error');
                return;
            }
            
            // Verificar se pode ser exclu√≠do
            if (orcamento.status === 'aprovado') {
                showNotification('‚ö†Ô∏è N√£o √© poss√≠vel excluir or√ßamentos aprovados!', 'warning');
                return;
            }
            
            // Criar modal de confirma√ß√£o personalizado
            const confirmacao = document.createElement('div');
            confirmacao.id = 'modal-confirmacao-orcamento';
            confirmacao.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            confirmacao.innerHTML = `
                <div style="background: #000; border: 2px solid #f44336; border-radius: 15px; padding: 30px; max-width: 400px; text-align: center;">
                    <h3 style="color: #f44336; margin-top: 0;">‚ö†Ô∏è Confirmar Exclus√£o</h3>
                    <p style="color: white; margin: 20px 0;">Tem certeza que deseja excluir o or√ßamento:</p>
                    <p style="color: #ffd700; font-weight: 700; font-size: 1.1rem; margin: 15px 0;">${orcamento.cliente}</p>
                    <p style="color: #4CAF50; font-weight: 600; margin: 10px 0;">${orcamento.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>
                    <p style="color: #ccc; font-size: 0.9rem; margin-bottom: 25px;">Esta a√ß√£o n√£o pode ser desfeita!</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="confirmarExclusaoOrcamento(${index})" 
                                style="background: #f44336; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            üóëÔ∏è Excluir
                        </button>
                        <button onclick="fecharModalConfirmacao('modal-confirmacao-orcamento')" 
                                style="background: #333; color: #ffd700; border: 2px solid #ffd700; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            ‚ùå Cancelar
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmacao);
        }
        
        function confirmarExclusaoOrcamento(index) {
            const orcamento = orcamentos[index];
            orcamentos.splice(index, 1);
            fecharModalConfirmacao('modal-confirmacao-orcamento');
            atualizarDashboard();
            atualizarTabelaOrcamentos();
            showNotification(`‚úÖ Or√ßamento de "${orcamento.cliente}" exclu√≠do com sucesso!`, 'success');
        }

        function excluirCliente(index) {
            const cliente = clientes[index];
            if (!cliente) {
                showNotification('‚ùå Cliente n√£o encontrado!', 'error');
                return;
            }
            
            // Criar modal de confirma√ß√£o personalizado
            const confirmacao = document.createElement('div');
            confirmacao.id = 'modal-confirmacao-cliente';
            confirmacao.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            confirmacao.innerHTML = `
                <div style="background: #000; border: 2px solid #f44336; border-radius: 15px; padding: 30px; max-width: 400px; text-align: center;">
                    <h3 style="color: #f44336; margin-top: 0;">‚ö†Ô∏è Confirmar Exclus√£o</h3>
                    <p style="color: white; margin: 20px 0;">Tem certeza que deseja excluir o cliente:</p>
                    <p style="color: #ffd700; font-weight: 700; font-size: 1.1rem; margin: 15px 0;">${cliente.nome}</p>
                    <p style="color: #ccc; font-size: 0.9rem; margin-bottom: 25px;">Esta a√ß√£o n√£o pode ser desfeita!</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="confirmarExclusaoCliente(${index})" 
                                style="background: #f44336; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            üóëÔ∏è Excluir
                        </button>
                        <button onclick="fecharModalConfirmacao('modal-confirmacao-cliente')" 
                                style="background: #333; color: #ffd700; border: 2px solid #ffd700; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            ‚ùå Cancelar
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmacao);
        }
        
        function confirmarExclusaoCliente(index) {
            const cliente = clientes[index];
            clientes.splice(index, 1);
            fecharModalConfirmacao('modal-confirmacao-cliente');
            atualizarSelectClientes();
            abrirGerenciadorClientes();
            showNotification(`‚úÖ Cliente "${cliente.nome}" exclu√≠do com sucesso!`, 'success');
        }

        function excluirColaborador(index) {
            const colaborador = colaboradores[index];
            if (!colaborador) {
                showNotification('‚ùå Colaborador n√£o encontrado!', 'error');
                return;
            }
            
            // Criar modal de confirma√ß√£o personalizado
            const confirmacao = document.createElement('div');
            confirmacao.id = 'modal-confirmacao-colaborador';
            confirmacao.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            confirmacao.innerHTML = `
                <div style="background: #000; border: 2px solid #f44336; border-radius: 15px; padding: 30px; max-width: 400px; text-align: center;">
                    <h3 style="color: #f44336; margin-top: 0;">‚ö†Ô∏è Confirmar Exclus√£o</h3>
                    <p style="color: white; margin: 20px 0;">Tem certeza que deseja excluir o colaborador:</p>
                    <p style="color: #ffd700; font-weight: 700; font-size: 1.1rem; margin: 15px 0;">${colaborador.nome}</p>
                    <p style="color: #ccc; font-size: 0.9rem; margin-bottom: 25px;">Esta a√ß√£o n√£o pode ser desfeita!</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="confirmarExclusaoColaborador(${index})" 
                                style="background: #f44336; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            üóëÔ∏è Excluir
                        </button>
                        <button onclick="fecharModalConfirmacao('modal-confirmacao-colaborador')" 
                                style="background: #333; color: #ffd700; border: 2px solid #ffd700; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            ‚ùå Cancelar
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmacao);
        }
        
        function confirmarExclusaoColaborador(index) {
            const colaborador = colaboradores[index];
            colaboradores.splice(index, 1);
            fecharModalConfirmacao('modal-confirmacao-colaborador');
            atualizarDashboard();
            abrirGerenciadorColaboradores();
            showNotification(`‚úÖ Colaborador "${colaborador.nome}" exclu√≠do com sucesso!`, 'success');
        }

        function excluirDespesa(index) {
            const despesa = despesas[index];
            if (!despesa) {
                showNotification('‚ùå Despesa n√£o encontrada!', 'error');
                return;
            }
            
            // Criar modal de confirma√ß√£o personalizado
            const confirmacao = document.createElement('div');
            confirmacao.id = 'modal-confirmacao-despesa';
            confirmacao.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 2000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            confirmacao.innerHTML = `
                <div style="background: #000; border: 2px solid #f44336; border-radius: 15px; padding: 30px; max-width: 400px; text-align: center;">
                    <h3 style="color: #f44336; margin-top: 0;">‚ö†Ô∏è Confirmar Exclus√£o</h3>
                    <p style="color: white; margin: 20px 0;">Tem certeza que deseja excluir a despesa:</p>
                    <p style="color: #ffd700; font-weight: 700; font-size: 1.1rem; margin: 15px 0;">${despesa.titulo}</p>
                    <p style="color: #f44336; font-weight: 600; margin: 10px 0;">${despesa.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>
                    <p style="color: #ccc; font-size: 0.9rem; margin-bottom: 25px;">Esta a√ß√£o n√£o pode ser desfeita!</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="confirmarExclusaoDespesa(${index})" 
                                style="background: #f44336; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            üóëÔ∏è Excluir
                        </button>
                        <button onclick="fecharModalConfirmacao('modal-confirmacao-despesa')" 
                                style="background: #333; color: #ffd700; border: 2px solid #ffd700; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            ‚ùå Cancelar
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmacao);
        }
        
        function confirmarExclusaoDespesa(index) {
            const despesa = despesas[index];
            despesas.splice(index, 1);
            fecharModalConfirmacao('modal-confirmacao-despesa');
            atualizarDashboard();
            abrirGerenciadorDespesas();
            showNotification(`‚úÖ Despesa "${despesa.titulo}" exclu√≠da com sucesso!`, 'success');
        }

        // Fun√ß√£o para fechar modais de confirma√ß√£o
        function fecharModalConfirmacao(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.remove();
            }
        }

        // Fun√ß√µes de filtros
        function aplicarFiltros(event) {
            event.preventDefault();
            
            const cliente = document.getElementById('filtro-cliente').value.toLowerCase();
            const periodo = document.getElementById('filtro-periodo').value;
            const status = document.getElementById('filtro-status').value;
            
            let orcamentosFiltrados = [...orcamentos];
            
            // Filtrar por cliente (nome, CPF ou CNPJ)
            if (cliente) {
                orcamentosFiltrados = orcamentosFiltrados.filter(orc => 
                    orc.cliente.toLowerCase().includes(cliente) ||
                    (orc.cnpj && orc.cnpj.toLowerCase().includes(cliente))
                );
            }
            
            // Filtrar por status
            if (status !== 'todos') {
                orcamentosFiltrados = orcamentosFiltrados.filter(orc => orc.status === status);
            }
            
            // Filtrar por per√≠odo
            const hoje = new Date();
            if (periodo !== 'todos') {
                orcamentosFiltrados = orcamentosFiltrados.filter(orc => {
                    const dataOrcamento = new Date(orc.data.split('/').reverse().join('-'));
                    
                    switch (periodo) {
                        case 'mes-atual':
                            return dataOrcamento.getMonth() === hoje.getMonth() && 
                                   dataOrcamento.getFullYear() === hoje.getFullYear();
                        case 'ultimos-30-dias':
                            const trintaDiasAtras = new Date(hoje.getTime() - (30 * 24 * 60 * 60 * 1000));
                            return dataOrcamento >= trintaDiasAtras;
                        case 'ultimos-90-dias':
                            const noventaDiasAtras = new Date(hoje.getTime() - (90 * 24 * 60 * 60 * 1000));
                            return dataOrcamento >= noventaDiasAtras;
                        case 'este-ano':
                            return dataOrcamento.getFullYear() === hoje.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            
            // Atualizar tabela com resultados filtrados
            const tbody = document.querySelector('.results-table tbody');
            tbody.innerHTML = '';
            
            if (orcamentosFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #ccc;">
                            Nenhum or√ßamento encontrado com os filtros aplicados
                        </td>
                    </tr>
                `;
            } else {
                orcamentosFiltrados.forEach((orcamento) => {
                    const indexOriginal = orcamentos.findIndex(orc => 
                        orc.cliente === orcamento.cliente && 
                        orc.data === orcamento.data && 
                        orc.valor === orcamento.valor
                    );
                    
                    const row = document.createElement('tr');
                    const statusColor = orcamento.status === 'aprovado' ? '#4CAF50' : 
                                      orcamento.status === 'rejeitado' ? '#f44336' : '#FF9800';
                    
                    const selectDisabled = orcamento.saldoPago ? 'disabled' : '';
                    const selectStyle = orcamento.saldoPago ? 
                        `color: white; border-color: ${statusColor}; background-color: ${statusColor}; font-weight: 600; opacity: 0.7; cursor: not-allowed;` :
                        `color: white; border-color: ${statusColor}; background-color: ${statusColor}; font-weight: 600;`;
                    
                    row.innerHTML = `
                        <td data-label="Data">${orcamento.data}</td>
                        <td data-label="Cliente">${orcamento.cliente}</td>
                        <td data-label="Tipo">Or√ßamento</td>
                        <td data-label="Valor">${orcamento.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                        <td data-label="Status">
                            <select class="status-select" onchange="alterarStatusOrcamento(this, ${indexOriginal})" style="${selectStyle}" ${selectDisabled}>
                                <option value="pendente" ${orcamento.status === 'pendente' ? 'selected' : ''}>Pendente</option>
                                <option value="aprovado" ${orcamento.status === 'aprovado' ? 'selected' : ''}>Aprovado</option>
                                <option value="rejeitado" ${orcamento.status === 'rejeitado' ? 'selected' : ''}>Rejeitado</option>
                            </select>
                        </td>
                        <td data-label="A√ß√µes">
                            <button onclick="verDetalhes('${orcamento.cliente}')" style="background: #ffd700; color: #000; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; margin-right: 5px;">üëÅÔ∏è Ver</button>
                            ${(orcamento.status === 'pendente' || orcamento.status === 'rejeitado') ? 
                                `<button onclick="excluirOrcamento(${indexOriginal})" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease;">üóëÔ∏è Excluir</button>` : 
                                ''
                            }
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            showNotification(`üîç Filtros aplicados: ${orcamentosFiltrados.length} resultado(s) encontrado(s)`, 'info');
        }

        function limparFiltros() {
            document.getElementById('form-filtros').reset();
            document.getElementById('filtro-periodo').value = 'mes-atual';
            document.getElementById('filtro-status').value = 'todos';
            atualizarTabelaOrcamentos();
            showNotification('üóëÔ∏è Filtros limpos. Mostrando todos os or√ßamentos.', 'info');
        }

        // Fun√ß√µes de clientes
        function atualizarSelectClientes() {
            const select = document.getElementById('cliente-select');
            if (!select) return;
            
            select.innerHTML = '<option value="">-- Selecione um cliente --</option>';
            
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.nome;
                option.textContent = cliente.nome;
                select.appendChild(option);
            });
        }

        function atualizarListaClientes() {
            atualizarSelectClientes();
            showNotification('üîÑ Lista de clientes atualizada!', 'info');
        }

        function preencherDadosCliente() {
            const select = document.getElementById('cliente-select');
            const clienteSelecionado = clientes.find(c => c.nome === select.value);
            
            if (clienteSelecionado) {
                document.getElementById('orcamento-cliente-nome').value = clienteSelecionado.nome;
                document.getElementById('orcamento-cliente-cnpj').value = clienteSelecionado.cnpj;
                document.getElementById('orcamento-cliente-endereco').value = clienteSelecionado.endereco;
                document.getElementById('orcamento-cliente-numero').value = clienteSelecionado.numero;
                document.getElementById('orcamento-cliente-complemento').value = clienteSelecionado.complemento || '';
                document.getElementById('orcamento-cliente-cidade').value = clienteSelecionado.cidade;
                document.getElementById('orcamento-cliente-cep').value = clienteSelecionado.cep;
                document.getElementById('orcamento-cliente-telefone').value = clienteSelecionado.telefone;
                
                showNotification(`‚úÖ Dados do cliente ${clienteSelecionado.nome} preenchidos!`, 'success');
            }
        }

        // Fun√ß√µes de recebimento de saldo
        function abrirModalReceberSaldo() {
            if (!orcamentoAtual) {
                showNotification('‚ùå Erro: Or√ßamento n√£o encontrado!', 'error');
                return;
            }
            
            if (orcamentoAtual.saldoPago) {
                showNotification('‚ö†Ô∏è O saldo deste or√ßamento j√° foi pago!', 'warning');
                return;
            }
            
            document.getElementById('valor-saldo-receber').textContent = 
                (orcamentoAtual.saldoRestante || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            // Definir data atual como padr√£o
            const hoje = new Date();
            hoje.setMinutes(hoje.getMinutes() - hoje.getTimezoneOffset());
            document.getElementById('data-pagamento-saldo').value = hoje.toISOString().split('T')[0];
            
            openModal('receber-saldo');
        }

        function confirmarRecebimentoSaldo(event) {
            event.preventDefault();
            
            if (!orcamentoAtual) {
                showNotification('‚ùå Erro: Or√ßamento n√£o encontrado!', 'error');
                return;
            }
            
            const formaPagamento = document.getElementById('forma-pagamento-saldo').value;
            const dataPagamento = document.getElementById('data-pagamento-saldo').value;
            
            // Corrigir problema de fuso hor√°rio na data do pagamento
            const dataCorrigida = new Date(dataPagamento + 'T12:00:00');
            const dataPagamentoBR = dataCorrigida.toLocaleDateString('pt-BR');
            
            // Atualizar or√ßamento
            orcamentoAtual.saldoPago = true;
            orcamentoAtual.formaPagamentoSaldo = formaPagamento;
            orcamentoAtual.dataPagamentoSaldo = dataPagamentoBR;
            
            // Atualizar dashboard e tabela
            atualizarDashboard();
            atualizarTabelaOrcamentos();
            
            // Fechar modais
            closeModal('receber-saldo');
            closeModal('detalhes');
            
            showNotification(`‚úÖ Saldo de ${(orcamentoAtual.saldoRestante || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} recebido via ${formaPagamento} para ${orcamentoAtual.cliente}!`, 'success');
            
            // Limpar formul√°rio
            document.getElementById('form-receber-saldo').reset();
        }

        // Fun√ß√µes de vendas detalhadas
        function abrirDetalhesVendas() {
            const vendasAprovadas = orcamentos.filter(o => o.status === 'aprovado');
            const totalVendas = vendasAprovadas.reduce((total, venda) => total + venda.valor, 0);
            const totalEntradas = vendasAprovadas.reduce((total, venda) => total + (venda.valorEntrada || 0), 0);
            
            // Calcular total de saldos pendentes (n√£o pagos)
            const totalSaldosPendentes = vendasAprovadas
                .filter(venda => !venda.saldoPago)
                .reduce((total, venda) => total + (venda.saldoRestante || 0), 0);
            
            document.getElementById('total-vendas-modal').textContent = totalVendas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            document.getElementById('total-entradas-modal').textContent = totalEntradas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            document.getElementById('total-saldos-modal').textContent = totalSaldosPendentes.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            // Ordenar vendas por data (mais recentes primeiro)
            const vendasOrdenadas = [...vendasAprovadas].sort((a, b) => {
                const dataA = new Date(a.data.split('/').reverse().join('-'));
                const dataB = new Date(b.data.split('/').reverse().join('-'));
                return dataB - dataA;
            });
            
            const vendasContent = `
                <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px;">
                    <h3 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üìã Vendas Detalhadas</h3>
                    
                    ${vendasOrdenadas.length === 0 ? 
                        '<div style="text-align: center; color: #ccc; padding: 40px;">Nenhuma venda registrada este m√™s</div>' :
                        `<div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; background: #0a0a0a; border-radius: 8px; overflow: hidden;">
                                <thead>
                                    <tr style="background: #ffd700; color: #000;">
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Data</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Cliente</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Valor Total</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Entrada</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 600;">Saldo</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 600;">Status Saldo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${vendasOrdenadas.map(venda => {
                                        // Verificar se o saldo foi pago
                                        const saldoPago = venda.saldoPago === true;
                                        const statusSaldo = saldoPago ? '‚úÖ PAGO' : '‚è≥ PENDENTE';
                                        const corStatus = saldoPago ? '#4CAF50' : '#FF9800';
                                        const corSaldo = saldoPago ? '#4CAF50' : '#FF9800';
                                        
                                        return `
                                            <tr style="border-bottom: 1px solid #333;">
                                                <td style="padding: 12px; color: white;">${venda.data}</td>
                                                <td style="padding: 12px; color: white; font-weight: 600;">${venda.cliente}</td>
                                                <td style="padding: 12px; color: #4CAF50; font-weight: 600;">${venda.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                                <td style="padding: 12px; color: #4CAF50; font-weight: 600;">${(venda.valorEntrada || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                                <td style="padding: 12px; color: ${corSaldo}; font-weight: 600;">${(venda.saldoRestante || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                                <td style="padding: 12px; text-align: center;">
                                                    <span style="background: ${corStatus}; color: white; padding: 4px 12px; border-radius: 6px; font-weight: 600; font-size: 0.8rem;">
                                                        ${statusSaldo}
                                                    </span>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>`
                    }
                </div>
            `;
            
            document.getElementById('vendas-detalhadas-content').innerHTML = vendasContent;
            openModal('vendas');
        }

        // Fun√ß√µes de PDF e Nota de Servi√ßo
        function baixarOrcamentoPDF() {
            if (!orcamentoAtual) {
                showNotification('‚ùå Erro: Or√ßamento n√£o encontrado!', 'error');
                return;
            }
            
            // Primeiro mostrar o preview do PDF
            mostrarPreviewPDF();
        }

        function mostrarPreviewPDF() {
            if (!orcamentoAtual) {
                showNotification('‚ùå Erro: Or√ßamento n√£o encontrado!', 'error');
                return;
            }

            // Criar modal de preview
            const modalPreview = document.createElement('div');
            modalPreview.id = 'modal-preview-pdf';
            modalPreview.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.9); z-index: 2000; display: flex; 
                align-items: center; justify-content: center; overflow-y: auto;
            `;
            
            const valorEntrada = orcamentoAtual.valorEntrada || 0;
            const saldoRestante = orcamentoAtual.saldoRestante || 0;
            
            modalPreview.innerHTML = `
                <div style="background: #fff; border-radius: 15px; padding: 0; max-width: 800px; width: 95%; max-height: 95%; overflow-y: auto; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
                    
                    <!-- Bot√£o fechar -->
                    <button onclick="fecharPreviewPDF()" style="position: absolute; top: 15px; right: 15px; background: #f44336; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: bold; z-index: 10; box-shadow: 0 4px 15px rgba(244,67,54,0.3);">√ó</button>
                    
                    <!-- Preview do PDF -->
                    <div style="padding: 40px; color: #000; font-family: Arial, sans-serif; line-height: 1.4;">
                        
                        <!-- Cabe√ßalho da empresa -->
                        <div style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); margin: -40px -40px 30px -40px; padding: 25px 40px; position: relative;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 20px;">
                                <div>
                                    <h1 style="margin: 0; font-size: 24px; font-weight: bold; color: #000;">CUNHA REPAROS</h1>
                                    <p style="margin: 5px 0 0 0; font-style: italic; color: #000; opacity: 0.8;">"Solu√ß√µes para o seu dia a dia"</p>
                                </div>
                                <div style="text-align: right; font-size: 11px; color: #000;">
                                    <div><strong>CNPJ:</strong> 50.373.624/0001-22</div>
                                    <div><strong>Endere√ßo:</strong> Rua C√¢ndido Mariano, 302</div>
                                    <div>Centro Norte, Cuiab√° ‚Äì MT</div>
                                    <div><strong>Tel:</strong> (65) 9 9820-2236</div>
                                    <div><strong>Email:</strong> cunhareparos2021@gmail.com</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- T√≠tulo do or√ßamento -->
                        <div style="text-align: center; margin-bottom: 25px;">
                            <div style="background: #000; color: #ffd700; padding: 12px 30px; border-radius: 25px; display: inline-block; font-size: 18px; font-weight: bold; border: 2px solid #ffd700;">
                                üìã OR√áAMENTO DETALHADO
                            </div>
                        </div>
                        
                        <!-- Informa√ß√µes b√°sicas -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #ffd700;">
                                <div style="color: #666; font-weight: bold; margin-bottom: 5px;">üìÖ Data de Emiss√£o</div>
                                <div style="font-size: 16px; font-weight: bold; color: #000;">${orcamentoAtual.data}</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #ffd700;">
                                <div style="color: #666; font-weight: bold; margin-bottom: 5px;">üìä Status</div>
                                <div style="font-size: 16px; font-weight: bold; color: ${orcamentoAtual.status === 'aprovado' ? '#4CAF50' : orcamentoAtual.status === 'rejeitado' ? '#f44336' : '#FF9800'};">${orcamentoAtual.status.toUpperCase()}</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #ffd700;">
                                <div style="color: #666; font-weight: bold; margin-bottom: 5px;">üí∞ Valor Total</div>
                                <div style="font-size: 18px; font-weight: bold; color: #4CAF50;">${orcamentoAtual.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>
                            </div>
                        </div>
                        
                        <!-- Dados do cliente -->
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 25px; border: 2px solid #ffd700;">
                            <h3 style="color: #000; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                <span style="background: #ffd700; color: #000; padding: 8px; border-radius: 50%;">üë§</span>
                                DADOS DO CLIENTE
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div>
                                    <strong style="color: #666;">Nome/Raz√£o Social:</strong><br>
                                    <span style="color: #000; font-weight: 600;">${orcamentoAtual.cliente}</span>
                                </div>
                                <div>
                                    <strong style="color: #666;">CNPJ/CPF:</strong><br>
                                    <span style="color: #000;">${orcamentoAtual.cnpj || 'N√£o informado'}</span>
                                </div>
                                <div>
                                    <strong style="color: #666;">Telefone:</strong><br>
                                    <span style="color: #000;">${orcamentoAtual.telefone || 'N√£o informado'}</span>
                                </div>
                                <div>
                                    <strong style="color: #666;">Endere√ßo:</strong><br>
                                    <span style="color: #000;">${orcamentoAtual.endereco || 'N√£o informado'}</span>
                                </div>
                                <div>
                                    <strong style="color: #666;">Cidade:</strong><br>
                                    <span style="color: #000;">${orcamentoAtual.cidade || 'N√£o informado'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Servi√ßos -->
                        ${orcamentoAtual.servicos && orcamentoAtual.servicos.length > 0 ? `
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 25px; border: 2px solid #ffd700;">
                            <h3 style="color: #000; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                <span style="background: #ffd700; color: #000; padding: 8px; border-radius: 50%;">üõ†Ô∏è</span>
                                SERVI√áOS DETALHADOS
                            </h3>
                            <div style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                    <thead>
                                        <tr style="background: #ffd700; color: #000;">
                                            <th style="padding: 12px; text-align: left; font-weight: bold; border-bottom: 2px solid #000;">C√≥d.</th>
                                            <th style="padding: 12px; text-align: left; font-weight: bold; border-bottom: 2px solid #000;">Descri√ß√£o do Servi√ßo</th>
                                            <th style="padding: 12px; text-align: center; font-weight: bold; border-bottom: 2px solid #000;">Tipo</th>
                                            <th style="padding: 12px; text-align: center; font-weight: bold; border-bottom: 2px solid #000;">Qtd</th>
                                            <th style="padding: 12px; text-align: right; font-weight: bold; border-bottom: 2px solid #000;">Valor Unit.</th>
                                            <th style="padding: 12px; text-align: right; font-weight: bold; border-bottom: 2px solid #000;">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${orcamentoAtual.servicos.map((servico, index) => `
                                            <tr style="border-bottom: 1px solid #eee; ${index % 2 === 0 ? 'background: #f9f9f9;' : 'background: #fff;'}">
                                                <td style="padding: 12px; color: #000; text-align: center; font-weight: bold;">${servico.codigo}</td>
                                                <td style="padding: 12px; color: #000; font-weight: 500;">${servico.descricao}</td>
                                                <td style="padding: 12px; color: #000; text-align: center; font-weight: 600;">${servico.tipo}</td>
                                                <td style="padding: 12px; color: #000; text-align: center; font-weight: 600;">${servico.quantidade}</td>
                                                <td style="padding: 12px; color: #000; text-align: right; font-weight: 600;">${servico.valorUnitario.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                                <td style="padding: 12px; color: #4CAF50; text-align: right; font-weight: bold; font-size: 16px;">${servico.valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Condi√ß√µes de Pagamento -->
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 25px; border: 2px solid #4CAF50;">
                            <h3 style="color: #000; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                <span style="background: #4CAF50; color: #fff; padding: 8px; border-radius: 50%;">üí≥</span>
                                CONDI√á√ïES DE PAGAMENTO
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                <div style="background: #fff; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50; text-align: center;">
                                    <div style="color: #666; font-weight: bold; margin-bottom: 8px;">üí∞ Entrada</div>
                                    <div style="color: #4CAF50; font-size: 20px; font-weight: bold;">${valorEntrada.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>
                                    ${orcamentoAtual.formaPagamentoEntrada ? `<div style="color: #666; font-size: 12px; margin-top: 5px;">Pago via ${orcamentoAtual.formaPagamentoEntrada}</div>` : ''}
                                </div>
                                <div style="background: #fff; padding: 15px; border-radius: 8px; border-left: 4px solid #FF9800; text-align: center;">
                                    <div style="color: #666; font-weight: bold; margin-bottom: 8px;">üí∞ Saldo Restante</div>
                                    <div style="color: #FF9800; font-size: 20px; font-weight: bold;">${saldoRestante.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>
                                    <div style="color: ${orcamentoAtual.saldoPago ? '#4CAF50' : '#FF9800'}; font-size: 12px; font-weight: bold; margin-top: 5px;">
                                        ${orcamentoAtual.saldoPago ? '‚úÖ PAGO' : '‚è≥ PENDENTE'}
                                    </div>
                                </div>
                                <div style="background: #fff; padding: 15px; border-radius: 8px; border-left: 4px solid #ffd700; text-align: center;">
                                    <div style="color: #666; font-weight: bold; margin-bottom: 8px;">üí∞ Total Geral</div>
                                    <div style="color: #000; font-size: 24px; font-weight: bold;">${orcamentoAtual.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Condi√ß√µes Gerais -->
                        ${orcamentoAtual.condicoes ? `
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 25px; border: 2px solid #666;">
                            <h3 style="color: #000; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                <span style="background: #666; color: #fff; padding: 8px; border-radius: 50%;">üìã</span>
                                CONDI√á√ïES GERAIS
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div>
                                    <strong style="color: #666;">Prazo de Execu√ß√£o:</strong><br>
                                    <span style="color: #000; font-weight: 600;">${orcamentoAtual.condicoes.prazoExecucao}</span>
                                </div>
                                <div>
                                    <strong style="color: #666;">Condi√ß√µes de Pagamento:</strong><br>
                                    <span style="color: #000; font-weight: 600;">${orcamentoAtual.condicoes.condicoesPagamento}</span>
                                </div>
                                <div>
                                    <strong style="color: #666;">Validade do Or√ßamento:</strong><br>
                                    <span style="color: #000; font-weight: 600;">${orcamentoAtual.condicoes.validadeOrcamento}</span>
                                </div>
                                <div>
                                    <strong style="color: #666;">Materiais:</strong><br>
                                    <span style="color: #000; font-weight: 600;">${orcamentoAtual.condicoes.materiaisInclusos}</span>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Rodap√© -->
                        <div style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); margin: 30px -40px -40px -40px; padding: 20px 40px; text-align: center; border-top: 3px solid #000;">
                            <div style="color: #000; font-weight: bold; font-size: 16px; margin-bottom: 5px;">CUNHA REPAROS</div>
                            <div style="color: #000; font-size: 12px; margin-bottom: 8px;">"Solu√ß√µes para o seu dia a dia"</div>
                            <div style="color: #000; font-size: 11px;">
                                üìß cunhareparos2021@gmail.com | üìû (65) 9 9820-2236 | üìç Rua C√¢ndido Mariano, 302 - Centro Norte, Cuiab√°/MT
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√µes de a√ß√£o -->
                    <div style="background: #f8f9fa; padding: 20px; border-top: 2px solid #eee; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="confirmarDownloadPDF()" style="background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 16px; box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3); transition: all 0.3s ease; display: flex; align-items: center; gap: 10px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(76, 175, 80, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(76, 175, 80, 0.3)'">
                            <span style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 50%; font-size: 18px;">üìÑ</span>
                            Baixar PDF
                        </button>
                        <button onclick="fecharPreviewPDF()" style="background: linear-gradient(135deg, #666 0%, #888 100%); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 16px; box-shadow: 0 5px 15px rgba(102, 102, 102, 0.3); transition: all 0.3s ease; display: flex; align-items: center; gap: 10px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 102, 102, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(102, 102, 102, 0.3)'">
                            <span style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 50%; font-size: 18px;">üö™</span>
                            Fechar
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modalPreview);
        }

        function fecharPreviewPDF() {
            const modal = document.getElementById('modal-preview-pdf');
            if (modal) {
                modal.remove();
            }
        }

        function confirmarDownloadPDF() {
            fecharPreviewPDF();
            gerarPDFReal();
        }

        function gerarPDFReal() {
            showNotification('üìÑ Gerando PDF do or√ßamento...', 'info');
            
            // Usar jsPDF para gerar o PDF real
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configura√ß√µes iniciais
                let yPosition = 20;
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;
                const contentWidth = pageWidth - (margin * 2);
                const rodapeAltura = 35; // Altura reservada para o rodap√©
                const maxY = pageHeight - rodapeAltura; // Posi√ß√£o m√°xima antes de quebrar p√°gina
                
                // Fun√ß√£o para verificar se precisa quebrar p√°gina
                function verificarQuebraPagina(alturaAdicional = 10) {
                    if (yPosition + alturaAdicional > maxY) {
                        adicionarRodape();
                        doc.addPage();
                        adicionarCabecalho();
                        yPosition = 75; // Posi√ß√£o ap√≥s cabe√ßalho na nova p√°gina
                        return true;
                    }
                    return false;
                }
                
                // Fun√ß√£o para adicionar cabe√ßalho
                function adicionarCabecalho() {
                    // Cabe√ßalho Premium da empresa
                    doc.setFillColor(255, 215, 0);
                    doc.rect(0, 0, pageWidth, 45, 'F');
                    
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(22);
                    doc.setFont(undefined, 'bold');
                    doc.text('CUNHA REPAROS', margin, 15);
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'italic');
                    doc.text('"Solu√ß√µes para o seu dia a dia"', margin, 25);
                    
                    // Informa√ß√µes da empresa (lado direito)
                    doc.setFontSize(8);
                    doc.setFont(undefined, 'normal');
                    const empresaInfo = [
                        'CNPJ: 50.373.624/0001-22',
                        'Rua C√¢ndido Mariano, 302',
                        'Centro Norte, Cuiab√° ‚Äì MT',
                        'Tel: (65) 9 9820-2236',
                        'Email: cunhareparos2021@gmail.com'
                    ];
                    
                    empresaInfo.forEach((info, index) => {
                        doc.text(info, pageWidth - margin - 65, 12 + (index * 4));
                    });
                    
                    // T√≠tulo do Or√ßamento Premium
                    doc.setFillColor(0, 0, 0);
                    doc.rect(margin, 50, contentWidth, 15, 'F');
                    doc.setTextColor(255, 215, 0);
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    doc.text('OR√áAMENTO DETALHADO', pageWidth / 2, 60, { align: 'center' });
                }
                
                // Fun√ß√£o para adicionar rodap√©
                function adicionarRodape() {
                    const rodapeY = pageHeight - 25;
                    doc.setFillColor(255, 215, 0);
                    doc.rect(0, rodapeY - 5, pageWidth, 30, 'F');
                    
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.text('CUNHA REPAROS', pageWidth / 2, rodapeY + 2, { align: 'center' });
                    doc.setFont(undefined, 'italic');
                    doc.text('"Solu√ß√µes para o seu dia a dia"', pageWidth / 2, rodapeY + 8, { align: 'center' });
                    doc.setFontSize(8);
                    doc.setFont(undefined, 'normal');
                    doc.text('cunhareparos2021@gmail.com | (65) 9 9820-2236 | Rua C√¢ndido Mariano, 302 - Centro Norte, Cuiab√°/MT', pageWidth / 2, rodapeY + 15, { align: 'center' });
                }
                
                // Adicionar cabe√ßalho inicial
                adicionarCabecalho();
                yPosition = 75;
                
                // Informa√ß√µes do or√ßamento
                verificarQuebraPagina(20);
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`Data de Emiss√£o: ${orcamentoAtual.data}`, margin, yPosition);
                doc.text(`Status: ${orcamentoAtual.status.toUpperCase()}`, pageWidth - margin - 40, yPosition);
                yPosition += 15;
                
                // Dados do cliente
                verificarQuebraPagina(40);
                doc.setFont(undefined, 'bold');
                doc.text('DADOS DO CLIENTE:', margin, yPosition);
                yPosition += 8;
                
                doc.setFont(undefined, 'normal');
                const clienteInfo = [
                    `Nome/Raz√£o Social: ${orcamentoAtual.cliente}`,
                    `CNPJ/CPF: ${orcamentoAtual.cnpj || 'N√£o informado'}`,
                    `Telefone: ${orcamentoAtual.telefone || 'N√£o informado'}`,
                    `Endere√ßo: ${orcamentoAtual.endereco || 'N√£o informado'}`,
                    `Cidade: ${orcamentoAtual.cidade || 'N√£o informado'}`
                ];
                
                clienteInfo.forEach(info => {
                    verificarQuebraPagina(8);
                    doc.text(info, margin, yPosition);
                    yPosition += 6;
                });
                
                // Servi√ßos
                yPosition += 10;
                verificarQuebraPagina(25);
                doc.setFont(undefined, 'bold');
                doc.text('SERVI√áOS DETALHADOS:', margin, yPosition);
                yPosition += 8;
                
                // Cabe√ßalho da tabela de servi√ßos
                verificarQuebraPagina(15);
                doc.setFillColor(240, 240, 240);
                doc.rect(margin, yPosition - 2, contentWidth, 8, 'F');
                
                doc.setFontSize(8);
                doc.setFont(undefined, 'bold');
                doc.text('C√≥d.', margin + 2, yPosition + 3);
                doc.text('Descri√ß√£o', margin + 20, yPosition + 3);
                doc.text('Tipo', margin + 100, yPosition + 3);
                doc.text('Qtd', margin + 120, yPosition + 3);
                doc.text('Valor Unit.', margin + 135, yPosition + 3);
                doc.text('Total', margin + 160, yPosition + 3);
                yPosition += 10;
                
                // Itens dos servi√ßos
                doc.setFont(undefined, 'normal');
                if (orcamentoAtual.servicos && orcamentoAtual.servicos.length > 0) {
                    orcamentoAtual.servicos.forEach(servico => {
                        // Calcular altura necess√°ria para este servi√ßo
                        const descricao = servico.descricao;
                        let alturaServico = 8;
                        
                        if (descricao.length > 35) {
                            const palavras = descricao.split(' ');
                            let linha = '';
                            let linhas = [];
                            
                            palavras.forEach(palavra => {
                                if ((linha + palavra).length > 35) {
                                    linhas.push(linha.trim());
                                    linha = palavra + ' ';
                                } else {
                                    linha += palavra + ' ';
                                }
                            });
                            if (linha.trim()) linhas.push(linha.trim());
                            
                            alturaServico = linhas.length * 4 + 4;
                        }
                        
                        // Verificar se precisa quebrar p√°gina para este servi√ßo
                        verificarQuebraPagina(alturaServico);
                        
                        doc.text(servico.codigo.toString(), margin + 2, yPosition);
                        
                        // Quebrar descri√ß√£o longa
                        if (descricao.length > 35) {
                            const palavras = descricao.split(' ');
                            let linha = '';
                            let linhas = [];
                            
                            palavras.forEach(palavra => {
                                if ((linha + palavra).length > 35) {
                                    linhas.push(linha.trim());
                                    linha = palavra + ' ';
                                } else {
                                    linha += palavra + ' ';
                                }
                            });
                            if (linha.trim()) linhas.push(linha.trim());
                            
                            linhas.forEach((linha, index) => {
                                doc.text(linha, margin + 20, yPosition + (index * 4));
                            });
                            yPosition += (linhas.length - 1) * 4;
                        } else {
                            doc.text(descricao, margin + 20, yPosition);
                        }
                        
                        doc.text(servico.tipo, margin + 100, yPosition);
                        doc.text(servico.quantidade.toString(), margin + 120, yPosition);
                        doc.text(servico.valorUnitario.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }), margin + 135, yPosition);
                        doc.text(servico.valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }), margin + 160, yPosition);
                        yPosition += 8;
                    });
                }
                
                // Total
                yPosition += 10;
                verificarQuebraPagina(20);
                doc.setFont(undefined, 'bold');
                doc.setFontSize(12);
                doc.text(`VALOR TOTAL: ${orcamentoAtual.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`, pageWidth - margin - 60, yPosition);
                yPosition += 15;
                
                // Condi√ß√µes de pagamento
                verificarQuebraPagina(30);
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('CONDI√á√ïES DE PAGAMENTO:', margin, yPosition);
                yPosition += 8;
                
                doc.setFont(undefined, 'normal');
                const valorEntrada = orcamentoAtual.valorEntrada || 0;
                const saldoRestante = orcamentoAtual.saldoRestante || 0;
                
                verificarQuebraPagina(8);
                doc.text(`Entrada: ${valorEntrada.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`, margin, yPosition);
                if (orcamentoAtual.formaPagamentoEntrada) {
                    verificarQuebraPagina(6);
                    doc.text(`(Pago via ${orcamentoAtual.formaPagamentoEntrada} em ${orcamentoAtual.dataPagamentoEntrada})`, margin + 5, yPosition + 4);
                    yPosition += 4;
                }
                yPosition += 6;
                verificarQuebraPagina(8);
                doc.text(`Saldo Restante: ${saldoRestante.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`, margin, yPosition);
                if (orcamentoAtual.saldoPago) {
                    doc.text('QUITADO', margin + 80, yPosition);
                    if (orcamentoAtual.formaPagamentoSaldo) {
                        verificarQuebraPagina(6);
                        doc.text(`(Pago via ${orcamentoAtual.formaPagamentoSaldo} em ${orcamentoAtual.dataPagamentoSaldo})`, margin + 5, yPosition + 4);
                        yPosition += 4;
                    }
                } else {
                    doc.text('PENDENTE', margin + 80, yPosition);
                }
                yPosition += 15;
                
                // Condi√ß√µes de pagamento
                verificarQuebraPagina(30);
                doc.setTextColor(0, 0, 0); // Garantir cor preta
                doc.setFont(undefined, 'bold');
                doc.setFontSize(12);
                doc.text('CONDI√á√ïES DE PAGAMENTO:', margin, yPosition);
                yPosition += 8;
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                verificarQuebraPagina(8);
                doc.text(`Entrada: ${valorEntrada.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`, margin, yPosition);
                if (orcamentoAtual.formaPagamentoEntrada) {
                    verificarQuebraPagina(6);
                    doc.text(`(Pago via ${orcamentoAtual.formaPagamentoEntrada} em ${orcamentoAtual.dataPagamentoEntrada})`, margin, yPosition + 4);
                    yPosition += 4;
                }
                yPosition += 6;
                verificarQuebraPagina(8);
                doc.text(`Saldo Restante: ${saldoRestante.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} ${orcamentoAtual.saldoPago ? 'QUITADO' : 'PENDENTE'}`, margin, yPosition);
                if (orcamentoAtual.saldoPago && orcamentoAtual.formaPagamentoSaldo) {
                    verificarQuebraPagina(6);
                    doc.text(`(Pago via ${orcamentoAtual.formaPagamentoSaldo} em ${orcamentoAtual.dataPagamentoSaldo})`, margin, yPosition + 4);
                    yPosition += 4;
                }
                yPosition += 15;
                
                // Condi√ß√µes gerais (se existirem)
                if (orcamentoAtual.condicoes) {
                    verificarQuebraPagina(40);
                    doc.setTextColor(0, 0, 0); // Garantir cor preta
                    doc.setFont(undefined, 'bold');
                    doc.setFontSize(12);
                    doc.text('CONDI√á√ïES GERAIS:', margin, yPosition);
                    yPosition += 8;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    verificarQuebraPagina(8);
                    doc.text(`Prazo de execu√ß√£o: ${orcamentoAtual.condicoes.prazoExecucao}`, margin, yPosition);
                    yPosition += 6;
                    verificarQuebraPagina(8);
                    doc.text(`Pagamento: ${orcamentoAtual.condicoes.condicoesPagamento}`, margin, yPosition);
                    yPosition += 6;
                    verificarQuebraPagina(8);
                    doc.text(`Validade: ${orcamentoAtual.condicoes.validadeOrcamento}`, margin, yPosition);
                    yPosition += 6;
                    verificarQuebraPagina(8);
                    doc.text(`Materiais: ${orcamentoAtual.condicoes.materiaisInclusos}`, margin, yPosition);
                }
                
                // Adicionar rodap√© na √∫ltima p√°gina
                adicionarRodape();
                
                // Salvar o PDF
                const nomeArquivo = `Orcamento_${orcamentoAtual.cliente.replace(/[^a-zA-Z0-9]/g, '_')}_${orcamentoAtual.data.replace(/\//g, '-')}.pdf`;
                doc.save(nomeArquivo);
                
                showNotification(`‚úÖ PDF "${nomeArquivo}" baixado com sucesso!`, 'success');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showNotification('‚ùå Erro ao gerar PDF. Tente novamente.', 'error');
            }
        }

        function abrirModalNotaServico() {
            if (!orcamentoAtual) {
                showNotification('‚ùå Erro: Or√ßamento n√£o encontrado!', 'error');
                return;
            }
            
            if (orcamentoAtual.status !== 'aprovado') {
                showNotification('‚ö†Ô∏è Apenas or√ßamentos aprovados podem gerar nota de servi√ßo!', 'warning');
                return;
            }
            
            // Preencher dados da nota de servi√ßo
            const hoje = new Date().toLocaleDateString('pt-BR');
            document.getElementById('data-emissao-nota').textContent = hoje;
            document.getElementById('data-orcamento-nota').textContent = orcamentoAtual.data;
            document.getElementById('data-conclusao-nota').textContent = hoje;
            
            // Dados do cliente
            const dadosClienteHTML = `
                <div><strong style="color: #ffd700;">Nome/Raz√£o Social:</strong><br><span style="color: #fff;">${orcamentoAtual.cliente}</span></div>
                <div><strong style="color: #ffd700;">CNPJ/CPF:</strong><br><span style="color: #fff;">${orcamentoAtual.cnpj || 'N√£o informado'}</span></div>
                <div><strong style="color: #ffd700;">Telefone:</strong><br><span style="color: #fff;">${orcamentoAtual.telefone || 'N√£o informado'}</span></div>
                <div><strong style="color: #ffd700;">Endere√ßo:</strong><br><span style="color: #fff;">${orcamentoAtual.endereco || 'N√£o informado'}</span></div>
                <div><strong style="color: #ffd700;">Cidade:</strong><br><span style="color: #fff;">${orcamentoAtual.cidade || 'N√£o informado'}</span></div>
            `;
            document.getElementById('dados-cliente-nota').innerHTML = dadosClienteHTML;
            
            // Servi√ßos executados
            if (orcamentoAtual.servicos && orcamentoAtual.servicos.length > 0) {
                const servicosHTML = `
                    <table style="width: 100%; border-collapse: collapse; background: #0a0a0a; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #ffd700; color: #000;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">C√≥d.</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Descri√ß√£o do Servi√ßo</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Tipo</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Qtd</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Valor Unit.</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orcamentoAtual.servicos.map(servico => `
                                <tr style="border-bottom: 1px solid #333;">
                                    <td style="padding: 12px; color: white; text-align: center; font-weight: 600;">${servico.codigo}</td>
                                    <td style="padding: 12px; color: white;">${servico.descricao}</td>
                                    <td style="padding: 12px; color: white; text-align: center;">${servico.tipo}</td>
                                    <td style="padding: 12px; color: white; text-align: center;">${servico.quantidade}</td>
                                    <td style="padding: 12px; color: white; text-align: right;">${servico.valorUnitario.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                    <td style="padding: 12px; color: #ffd700; font-weight: 600; text-align: right;">${servico.valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                document.getElementById('servicos-executados-nota').innerHTML = servicosHTML;
            }
            
            // Resumo financeiro
            const valorEntrada = orcamentoAtual.valorEntrada || 0;
            const saldoRestante = orcamentoAtual.saldoRestante || 0;
            
            const resumoFinanceiroHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="background: #0a0a0a; padding: 15px; border-radius: 10px; border: 2px solid #4CAF50; text-align: center;">
                        <div style="color: #4CAF50; font-weight: 600; margin-bottom: 8px;">üí∞ VALOR TOTAL</div>
                        <div style="color: #fff; font-size: 1.3rem; font-weight: 700;">${orcamentoAtual.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>
                    </div>
                    <div style="background: #0a0a0a; padding: 15px; border-radius: 10px; border: 2px solid #4CAF50; text-align: center;">
                        <div style="color: #4CAF50; font-weight: 600; margin-bottom: 8px;">üí≥ ENTRADA RECEBIDA</div>
                        <div style="color: #fff; font-size: 1.3rem; font-weight: 700;">${valorEntrada.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>
                        ${orcamentoAtual.formaPagamentoEntrada ? `<div style="color: #ccc; font-size: 0.8rem; margin-top: 5px;">via ${orcamentoAtual.formaPagamentoEntrada}</div>` : ''}
                        ${orcamentoAtual.dataPagamentoEntrada ? `<div style="color: #ccc; font-size: 0.8rem;">em ${orcamentoAtual.dataPagamentoEntrada}</div>` : ''}
                    </div>
                    <div style="background: #0a0a0a; padding: 15px; border-radius: 10px; border: 2px solid ${orcamentoAtual.saldoPago ? '#4CAF50' : '#FF9800'}; text-align: center;">
                        <div style="color: ${orcamentoAtual.saldoPago ? '#4CAF50' : '#FF9800'}; font-weight: 600; margin-bottom: 8px;">üí∞ SALDO RESTANTE</div>
                        <div style="color: #fff; font-size: 1.3rem; font-weight: 700;">${saldoRestante.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>
                        <div style="color: ${orcamentoAtual.saldoPago ? '#4CAF50' : '#FF9800'}; font-size: 0.9rem; font-weight: 600; margin-top: 5px;">
                            ${orcamentoAtual.saldoPago ? '‚úÖ QUITADO' : '‚è≥ PENDENTE'}
                        </div>
                        ${orcamentoAtual.saldoPago && orcamentoAtual.formaPagamentoSaldo ? `<div style="color: #ccc; font-size: 0.8rem; margin-top: 5px;">via ${orcamentoAtual.formaPagamentoSaldo} em ${orcamentoAtual.dataPagamentoSaldo}</div>` : ''}
                    </div>
                </div>
            `;
            document.getElementById('resumo-financeiro-nota').innerHTML = resumoFinanceiroHTML;
            
            // Status do servi√ßo
            const statusServicoHTML = `
                <div style="background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%); color: white; padding: 20px; border-radius: 15px; border: 3px solid #2E7D32; box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px;">
                        <span style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 50%; font-size: 1.5rem;">‚úÖ</span>
                        <div>
                            <div style="font-size: 1.4rem; font-weight: 700; margin-bottom: 5px;">SERVI√áO EXECUTADO COM SUCESSO</div>
                            <div style="font-size: 1rem; opacity: 0.9;">Todos os servi√ßos foram conclu√≠dos conforme especificado</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px; padding-top: 15px; border-top: 2px solid rgba(255,255,255,0.3);">
                        <div style="font-size: 0.9rem; opacity: 0.8;">Data de Conclus√£o: <strong>${hoje}</strong></div>
                    </div>
                </div>
            `;
            document.getElementById('status-servico-nota').innerHTML = statusServicoHTML;
            
            openModal('nota-servico');
        }

        function baixarNotaServicoPDF() {
            if (!orcamentoAtual) {
                showNotification('‚ùå Erro: Or√ßamento n√£o encontrado!', 'error');
                return;
            }
            
            showNotification('üìÑ Preparando download da Nota de Servi√ßo...', 'info');
            
            try {
                // Verificar se jsPDF est√° dispon√≠vel
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    throw new Error('Biblioteca jsPDF n√£o carregada');
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configura√ß√µes iniciais
                let yPosition = 20;
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;
                const contentWidth = pageWidth - (margin * 2);
                const rodapeAltura = 35; // Altura reservada para o rodap√©
                const maxY = pageHeight - rodapeAltura; // Posi√ß√£o m√°xima antes de quebrar p√°gina
                
                // Fun√ß√£o para verificar se precisa quebrar p√°gina
                function verificarQuebraPagina(alturaAdicional = 10) {
                    if (yPosition + alturaAdicional > maxY) {
                        adicionarRodape();
                        doc.addPage();
                        adicionarCabecalho();
                        yPosition = 75; // Posi√ß√£o ap√≥s cabe√ßalho na nova p√°gina
                        return true;
                    }
                    return false;
                }
                
                // Fun√ß√£o para adicionar cabe√ßalho
                function adicionarCabecalho() {
                    // Cabe√ßalho Premium da empresa
                    doc.setFillColor(255, 215, 0);
                    doc.rect(0, 0, pageWidth, 45, 'F');
                    
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(22);
                    doc.setFont(undefined, 'bold');
                    doc.text('CUNHA REPAROS', margin, 15);
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'italic');
                    doc.text('"Solu√ß√µes para o seu dia a dia"', margin, 25);
                    
                    // Informa√ß√µes da empresa (lado direito)
                    doc.setFontSize(8);
                    doc.setFont(undefined, 'normal');
                    const empresaInfo = [
                        'CNPJ: 50.373.624/0001-22',
                        'Rua C√¢ndido Mariano, 302',
                        'Centro Norte, Cuiab√° ‚Äì MT',
                        'Tel: (65) 9 9820-2236',
                        'Email: cunhareparos2021@gmail.com'
                    ];
                    
                    empresaInfo.forEach((info, index) => {
                        doc.text(info, pageWidth - margin - 65, 12 + (index * 4));
                    });
                    
                    // T√≠tulo da Nota de Servi√ßo Premium
                    doc.setFillColor(0, 0, 0);
                    doc.rect(margin, 50, contentWidth, 15, 'F');
                    doc.setTextColor(255, 215, 0);
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    doc.text('NOTA DE SERVICO EXECUTADO', pageWidth / 2, 60, { align: 'center' });
                }
                
                // Fun√ß√£o para adicionar rodap√©
                function adicionarRodape() {
                    const rodapeY = pageHeight - 25;
                    doc.setFillColor(255, 215, 0);
                    doc.rect(0, rodapeY - 5, pageWidth, 30, 'F');
                    
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.text('CUNHA REPAROS', pageWidth / 2, rodapeY + 2, { align: 'center' });
                    doc.setFont(undefined, 'italic');
                    doc.text('"Solucoes para o seu dia a dia"', pageWidth / 2, rodapeY + 8, { align: 'center' });
                    doc.setFontSize(8);
                    doc.setFont(undefined, 'normal');
                    doc.text('cunhareparos2021@gmail.com | (65) 9 9820-2236 | Rua Candido Mariano, 302 - Centro Norte, Cuiaba/MT', pageWidth / 2, rodapeY + 15, { align: 'center' });
                }
                
                // Adicionar cabe√ßalho inicial
                adicionarCabecalho();
                yPosition = 75;
                
                // Informa√ß√µes da nota
                verificarQuebraPagina(20);
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                const hoje = new Date().toLocaleDateString('pt-BR');
                doc.text(`Data de Emissao: ${hoje}`, margin, yPosition);
                doc.text(`Referente ao Orcamento: ${orcamentoAtual.data}`, pageWidth - margin - 60, yPosition);
                yPosition += 15;
                
                // Dados do cliente
                verificarQuebraPagina(40);
                doc.setFont(undefined, 'bold');
                doc.text('DADOS DO CLIENTE:', margin, yPosition);
                yPosition += 8;
                
                doc.setFont(undefined, 'normal');
                const clienteInfo = [
                    `Nome/Razao Social: ${orcamentoAtual.cliente}`,
                    `CNPJ/CPF: ${orcamentoAtual.cnpj || 'Nao informado'}`,
                    `Telefone: ${orcamentoAtual.telefone || 'Nao informado'}`,
                    `Endereco: ${orcamentoAtual.endereco || 'Nao informado'}`,
                    `Cidade: ${orcamentoAtual.cidade || 'Nao informado'}`
                ];
                
                clienteInfo.forEach(info => {
                    verificarQuebraPagina(8);
                    doc.text(info, margin, yPosition);
                    yPosition += 6;
                });
                
                // Servi√ßos executados
                yPosition += 10;
                verificarQuebraPagina(25);
                doc.setFont(undefined, 'bold');
                doc.text('SERVICOS EXECUTADOS:', margin, yPosition);
                yPosition += 8;
                
                // Cabe√ßalho da tabela de servi√ßos
                verificarQuebraPagina(15);
                doc.setFillColor(240, 240, 240);
                doc.rect(margin, yPosition - 2, contentWidth, 8, 'F');
                
                doc.setFontSize(8);
                doc.setFont(undefined, 'bold');
                doc.text('Cod.', margin + 2, yPosition + 3);
                doc.text('Descricao', margin + 20, yPosition + 3);
                doc.text('Tipo', margin + 100, yPosition + 3);
                doc.text('Qtd', margin + 120, yPosition + 3);
                doc.text('Valor Unit.', margin + 135, yPosition + 3);
                doc.text('Total', margin + 160, yPosition + 3);
                yPosition += 10;
                
                // Itens dos servi√ßos
                doc.setFont(undefined, 'normal');
                if (orcamentoAtual.servicos && orcamentoAtual.servicos.length > 0) {
                    orcamentoAtual.servicos.forEach(servico => {
                        // Calcular altura necess√°ria para este servi√ßo
                        const descricao = servico.descricao;
                        let alturaServico = 8;
                        
                        if (descricao.length > 35) {
                            const palavras = descricao.split(' ');
                            let linha = '';
                            let linhas = [];
                            
                            palavras.forEach(palavra => {
                                if ((linha + palavra).length > 35) {
                                    linhas.push(linha.trim());
                                    linha = palavra + ' ';
                                } else {
                                    linha += palavra + ' ';
                                }
                            });
                            if (linha.trim()) linhas.push(linha.trim());
                            
                            alturaServico = linhas.length * 4 + 4;
                        }
                        
                        // Verificar se precisa quebrar p√°gina para este servi√ßo
                        verificarQuebraPagina(alturaServico);
                        
                        doc.text(servico.codigo.toString(), margin + 2, yPosition);
                        
                        // Quebrar descri√ß√£o longa
                        if (descricao.length > 35) {
                            const palavras = descricao.split(' ');
                            let linha = '';
                            let linhas = [];
                            
                            palavras.forEach(palavra => {
                                if ((linha + palavra).length > 35) {
                                    linhas.push(linha.trim());
                                    linha = palavra + ' ';
                                } else {
                                    linha += palavra + ' ';
                                }
                            });
                            if (linha.trim()) linhas.push(linha.trim());
                            
                            linhas.forEach((linha, index) => {
                                doc.text(linha, margin + 20, yPosition + (index * 4));
                            });
                            yPosition += (linhas.length - 1) * 4;
                        } else {
                            doc.text(descricao, margin + 20, yPosition);
                        }
                        
                        doc.text(servico.tipo, margin + 100, yPosition);
                        doc.text(servico.quantidade.toString(), margin + 120, yPosition);
                        doc.text(servico.valorUnitario.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }), margin + 135, yPosition);
                        doc.text(servico.valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }), margin + 160, yPosition);
                        yPosition += 8;
                    });
                }
                
                // Resumo financeiro completo
                yPosition += 10;
                verificarQuebraPagina(50);
                doc.setFont(undefined, 'bold');
                doc.setFontSize(12);
                doc.text('RESUMO FINANCEIRO COMPLETO:', margin, yPosition);
                yPosition += 10;
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                const valorEntrada = orcamentoAtual.valorEntrada || 0;
                const saldoRestante = orcamentoAtual.saldoRestante || 0;
                
                verificarQuebraPagina(8);
                doc.text(`Valor Total do Servico: ${orcamentoAtual.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`, margin, yPosition);
                yPosition += 6;
                verificarQuebraPagina(8);
                doc.text(`Entrada Recebida: ${valorEntrada.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`, margin, yPosition);
                if (orcamentoAtual.formaPagamentoEntrada) {
                    verificarQuebraPagina(6);
                    doc.text(`(via ${orcamentoAtual.formaPagamentoEntrada} em ${orcamentoAtual.dataPagamentoEntrada})`, margin + 5, yPosition + 4);
                    yPosition += 4;
                }
                yPosition += 6;
                verificarQuebraPagina(8);
                doc.text(`Saldo Restante: ${saldoRestante.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`, margin, yPosition);
                if (orcamentoAtual.saldoPago) {
                    doc.text('QUITADO', margin + 80, yPosition);
                    if (orcamentoAtual.formaPagamentoSaldo) {
                        verificarQuebraPagina(6);
                        doc.text(`(via ${orcamentoAtual.formaPagamentoSaldo} em ${orcamentoAtual.dataPagamentoSaldo})`, margin + 5, yPosition + 4);
                        yPosition += 4;
                    }
                } else {
                    doc.text('PENDENTE', margin + 80, yPosition);
                }
                yPosition += 15;
                
                // Status do servi√ßo
                verificarQuebraPagina(25);
                doc.setFillColor(76, 175, 80);
                doc.rect(margin, yPosition - 5, contentWidth, 20, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('SERVICO EXECUTADO COM SUCESSO', pageWidth / 2, yPosition + 5, { align: 'center' });
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text('Todos os servicos foram concluidos conforme especificado', pageWidth / 2, yPosition + 12, { align: 'center' });
                yPosition += 25;
                
                // Declara√ß√£o de execu√ß√£o
                verificarQuebraPagina(35);
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'bold');
                doc.text('DECLARACAO DE EXECUCAO:', margin, yPosition);
                yPosition += 8;
                
                doc.setFont(undefined, 'normal');
                const declaracao = [
                    'Declaramos que todos os servicos descritos nesta nota foram executados',
                    'com qualidade e dentro dos prazos estabelecidos. Os materiais utilizados',
                    'sao de primeira qualidade e os servicos foram realizados por profissionais',
                    'qualificados da CUNHA REPAROS.'
                ];
                
                declaracao.forEach(linha => {
                    verificarQuebraPagina(8);
                    doc.text(linha, margin, yPosition);
                    yPosition += 5;
                });
                
                yPosition += 10;
                verificarQuebraPagina(20);
                doc.text(`Data de Conclusao: ${hoje}`, margin, yPosition);
                doc.text('Responsavel Tecnico: CUNHA REPAROS', margin, yPosition + 6);
                doc.text('CNPJ: 50.373.624/0001-22', margin, yPosition + 12);
                
                // Adicionar rodap√© na √∫ltima p√°gina
                adicionarRodape();
                
                // Criar nome do arquivo
                const clienteNome = orcamentoAtual.cliente.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_');
                const dataFormatada = hoje.replace(/\//g, '-');
                const nomeArquivo = `NotaServico_${clienteNome}_${dataFormatada}.pdf`;
                
                // For√ßar download do PDF
                const pdfBlob = doc.output('blob');
                const url = URL.createObjectURL(pdfBlob);
                
                // Criar link tempor√°rio para for√ßar download
                const link = document.createElement('a');
                link.href = url;
                link.download = nomeArquivo;
                link.style.display = 'none';
                
                // Adicionar ao DOM, clicar e remover
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Limpar URL tempor√°ria ap√≥s um tempo
                setTimeout(() => {
                    URL.revokeObjectURL(url);
                }, 1000);
                
                showNotification(`üìÑ Nota de Servi√ßo baixada: ${nomeArquivo}`, 'success');
                
                // Fechar modal ap√≥s download
                setTimeout(() => {
                    closeModal('nota-servico');
                }, 1500);
                
            } catch (error) {
                console.error('Erro ao baixar PDF da Nota de Servi√ßo:', error);
                showNotification('‚ùå Erro ao baixar PDF. Verifique se o navegador suporta downloads autom√°ticos.', 'error');
                
                // Fallback: tentar m√©todo alternativo
                try {
                    if (window.jspdf && window.jspdf.jsPDF) {
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF();
                        
                        // Vers√£o simplificada para fallback
                        doc.setFontSize(16);
                        doc.text('CUNHA REPAROS - NOTA DE SERVICO', 20, 20);
                        doc.setFontSize(12);
                        doc.text(`Cliente: ${orcamentoAtual.cliente}`, 20, 40);
                        doc.text(`Valor: ${orcamentoAtual.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`, 20, 50);
                        doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 20, 60);
                        
                        doc.save(`NotaServico_${orcamentoAtual.cliente.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`);
                        showNotification('üìÑ Nota de Servi√ßo (vers√£o simplificada) baixada com sucesso!', 'success');
                    }
                } catch (fallbackError) {
                    console.error('Erro no fallback:', fallbackError);
                    showNotification('‚ùå N√£o foi poss√≠vel baixar o PDF. Tente novamente ou use outro navegador.', 'error');
                }
            }
        }

        function imprimirNotaServico() {
            if (!orcamentoAtual) {
                showNotification('‚ùå Erro: Or√ßamento n√£o encontrado!', 'error');
                return;
            }
            
            showNotification('üñ®Ô∏è Preparando impress√£o da Nota de Servi√ßo...', 'info');
            
            // Simular impress√£o
            setTimeout(() => {
                showNotification(`‚úÖ Nota de Servi√ßo para ${orcamentoAtual.cliente} enviada para impress√£o!`, 'success');
            }, 1500);
        }

        // Fun√ß√µes de Importar e Exportar Dados
        function exportarDados() {
            try {
                // Validar se h√° dados para exportar
                const temDados = orcamentos.length > 0 || clientes.length > 0 || colaboradores.length > 0 || despesas.length > 0;
                
                if (!temDados) {
                    showNotification('‚ö†Ô∏è N√£o h√° dados para exportar! Cadastre alguns dados primeiro.', 'warning');
                    return;
                }
                
                // Criar objeto com todos os dados do sistema (c√≥pia profunda para evitar refer√™ncias)
                const dadosCompletos = {
                    versao: "2.0",
                    dataExportacao: new Date().toISOString(),
                    sistema: "Cunha Reparos - Sistema de Gest√£o Completo",
                    dispositivo: {
                        userAgent: navigator.userAgent,
                        plataforma: navigator.platform,
                        idioma: navigator.language
                    },
                    dados: {
                        orcamentos: JSON.parse(JSON.stringify(orcamentos)), // C√≥pia profunda
                        clientes: JSON.parse(JSON.stringify(clientes)),
                        colaboradores: JSON.parse(JSON.stringify(colaboradores)),
                        despesas: JSON.parse(JSON.stringify(despesas))
                    },
                    estatisticas: {
                        totalOrcamentos: orcamentos.length,
                        totalClientes: clientes.length,
                        totalColaboradores: colaboradores.length,
                        totalDespesas: despesas.length,
                        orcamentosPendentes: orcamentos.filter(o => o.status === 'pendente').length,
                        orcamentosAprovados: orcamentos.filter(o => o.status === 'aprovado').length,
                        orcamentosRejeitados: orcamentos.filter(o => o.status === 'rejeitado').length,
                        valorTotalVendas: orcamentos.filter(o => o.status === 'aprovado').reduce((total, venda) => total + venda.valor, 0),
                        valorTotalDespesas: despesas.reduce((total, despesa) => total + despesa.valor, 0),
                        colaboradoresAtivos: colaboradores.filter(c => c.status === 'Ativo').length,
                        saldosPendentes: orcamentos.filter(o => o.status === 'aprovado' && !o.saldoPago).length,
                        saldosQuitados: orcamentos.filter(o => o.status === 'aprovado' && o.saldoPago).length
                    },
                    integridade: {
                        checksum: gerarChecksum(orcamentos, clientes, colaboradores, despesas),
                        timestamp: Date.now()
                    }
                };
                
                // Validar integridade dos dados antes de exportar
                if (!validarIntegridadeDados(dadosCompletos.dados)) {
                    showNotification('‚ùå Erro na valida√ß√£o dos dados. N√£o √© poss√≠vel exportar.', 'error');
                    return;
                }
                
                // Converter para JSON com formata√ß√£o
                const dadosJSON = JSON.stringify(dadosCompletos, null, 2);
                
                // Verificar tamanho do arquivo
                const tamanhoMB = (new Blob([dadosJSON]).size / 1024 / 1024).toFixed(2);
                
                // Criar arquivo para download
                const blob = new Blob([dadosJSON], { type: 'application/json;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                // Criar nome do arquivo com data e hora atual
                const agora = new Date();
                const dataFormatada = agora.toLocaleDateString('pt-BR').replace(/\//g, '-');
                const horaFormatada = agora.toLocaleTimeString('pt-BR', { hour12: false }).replace(/:/g, '-');
                const nomeArquivo = `CunhaReparos_Backup_Completo_${dataFormatada}_${horaFormatada}.json`;
                
                // Criar link tempor√°rio para download
                const link = document.createElement('a');
                link.href = url;
                link.download = nomeArquivo;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Limpar URL tempor√°ria
                setTimeout(() => URL.revokeObjectURL(url), 1000);
                
                showNotification(`üì§ Backup completo exportado! Arquivo: ${nomeArquivo} (${tamanhoMB} MB)`, 'success');
                
                // Mostrar resumo detalhado da exporta√ß√£o
                setTimeout(() => {
                    const resumo = `üìä BACKUP COMPLETO: ${dadosCompletos.estatisticas.totalOrcamentos} or√ßamentos (${dadosCompletos.estatisticas.orcamentosAprovados} aprovados), ${dadosCompletos.estatisticas.totalClientes} clientes, ${dadosCompletos.estatisticas.totalColaboradores} colaboradores, ${dadosCompletos.estatisticas.totalDespesas} despesas`;
                    showNotification(resumo, 'info');
                }, 2000);
                
                // Log para debug
                console.log('‚úÖ Dados exportados com sucesso:', {
                    arquivo: nomeArquivo,
                    tamanho: tamanhoMB + ' MB',
                    registros: dadosCompletos.estatisticas,
                    checksum: dadosCompletos.integridade.checksum
                });
                
            } catch (error) {
                console.error('‚ùå Erro ao exportar dados:', error);
                showNotification('‚ùå Erro ao exportar dados. Verifique o console para mais detalhes.', 'error');
            }
        }

        // Fun√ß√£o para gerar checksum simples dos dados
        function gerarChecksum(orcamentos, clientes, colaboradores, despesas) {
            try {
                const dadosString = JSON.stringify({
                    o: orcamentos.length,
                    c: clientes.length,
                    col: colaboradores.length,
                    d: despesas.length,
                    timestamp: Date.now()
                });
                
                // Gerar hash simples
                let hash = 0;
                for (let i = 0; i < dadosString.length; i++) {
                    const char = dadosString.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Converter para 32bit
                }
                return Math.abs(hash).toString(16);
            } catch (error) {
                return 'erro-checksum';
            }
        }

        // Fun√ß√£o para validar integridade dos dados
        function validarIntegridadeDados(dados) {
            try {
                // Verificar se todos os arrays existem
                if (!Array.isArray(dados.orcamentos) || 
                    !Array.isArray(dados.clientes) || 
                    !Array.isArray(dados.colaboradores) || 
                    !Array.isArray(dados.despesas)) {
                    return false;
                }
                
                // Verificar estrutura b√°sica dos or√ßamentos
                for (const orc of dados.orcamentos) {
                    if (!orc.cliente || !orc.valor || !orc.data || !orc.status) {
                        console.warn('Or√ßamento com dados incompletos:', orc);
                        return false;
                    }
                }
                
                // Verificar estrutura b√°sica dos clientes
                for (const cli of dados.clientes) {
                    if (!cli.nome || !cli.cnpj) {
                        console.warn('Cliente com dados incompletos:', cli);
                        return false;
                    }
                }
                
                // Verificar estrutura b√°sica dos colaboradores
                for (const col of dados.colaboradores) {
                    if (!col.nome || !col.cpf || !col.cargo) {
                        console.warn('Colaborador com dados incompletos:', col);
                        return false;
                    }
                }
                
                // Verificar estrutura b√°sica das despesas
                for (const desp of dados.despesas) {
                    if (!desp.titulo || !desp.valor || !desp.data) {
                        console.warn('Despesa com dados incompletos:', desp);
                        return false;
                    }
                }
                
                return true;
            } catch (error) {
                console.error('Erro na valida√ß√£o de integridade:', error);
                return false;
            }
        }

        function importarDados(event) {
            event.preventDefault();
            
            const arquivoInput = document.getElementById('arquivo-importacao');
            const arquivo = arquivoInput.files[0];
            
            if (!arquivo) {
                showNotification('‚ö†Ô∏è Por favor, selecione um arquivo para importar!', 'warning');
                return;
            }
            
            // Verificar se √© um arquivo JSON
            if (!arquivo.name.toLowerCase().endsWith('.json')) {
                showNotification('‚ùå Por favor, selecione apenas arquivos .json!', 'error');
                return;
            }
            
            // Verificar tamanho do arquivo (m√°ximo 50MB)
            const tamanhoMaxMB = 50;
            const tamanhoArquivoMB = arquivo.size / 1024 / 1024;
            if (tamanhoArquivoMB > tamanhoMaxMB) {
                showNotification(`‚ùå Arquivo muito grande! M√°ximo permitido: ${tamanhoMaxMB}MB. Seu arquivo: ${tamanhoArquivoMB.toFixed(2)}MB`, 'error');
                return;
            }
            
            showNotification('üì• Lendo arquivo de backup...', 'info');
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const dadosImportados = JSON.parse(e.target.result);
                    
                    // Valida√ß√µes de seguran√ßa e integridade
                    const validacao = validarArquivoImportacao(dadosImportados);
                    if (!validacao.valido) {
                        showNotification(`‚ùå ${validacao.erro}`, 'error');
                        return;
                    }
                    
                    // Criar modal de confirma√ß√£o detalhado
                    const confirmacao = document.createElement('div');
                    confirmacao.id = 'modal-confirmacao-importacao';
                    confirmacao.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                        background: rgba(0,0,0,0.95); z-index: 3000; display: flex; 
                        align-items: center; justify-content: center; overflow-y: auto;
                    `;
                    
                    const estatisticas = dadosImportados.estatisticas || {};
                    const dataExportacao = dadosImportados.dataExportacao ? 
                        new Date(dadosImportados.dataExportacao).toLocaleString('pt-BR') : 'N√£o informada';
                    
                    // Calcular estat√≠sticas atuais para compara√ß√£o
                    const estatisticasAtuais = {
                        orcamentos: orcamentos.length,
                        clientes: clientes.length,
                        colaboradores: colaboradores.length,
                        despesas: despesas.length
                    };
                    
                    confirmacao.innerHTML = `
                        <div style="background: #000; border: 3px solid #4CAF50; border-radius: 15px; padding: 30px; max-width: 600px; width: 95%; max-height: 90%; overflow-y: auto; text-align: center; box-shadow: 0 20px 60px rgba(76, 175, 80, 0.3);">
                            <h3 style="color: #4CAF50; margin-top: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <span style="background: #4CAF50; color: #000; padding: 10px; border-radius: 50%; font-size: 1.2rem;">üì•</span>
                                Confirmar Importa√ß√£o Completa
                            </h3>
                            
                            <!-- Informa√ß√µes do Backup -->
                            <div style="background: #1a1a1a; border: 2px solid #ffd700; border-radius: 10px; padding: 20px; margin: 20px 0; text-align: left;">
                                <h4 style="color: #ffd700; margin-top: 0; margin-bottom: 15px;">üìä Informa√ß√µes do Backup:</h4>
                                <div style="color: white; line-height: 1.6; font-size: 0.9rem;">
                                    <p><strong style="color: #4CAF50;">üìÖ Data do Backup:</strong> ${dataExportacao}</p>
                                    <p><strong style="color: #4CAF50;">üîß Vers√£o:</strong> ${dadosImportados.versao || 'N√£o informada'}</p>
                                    <p><strong style="color: #4CAF50;">üíª Sistema:</strong> ${dadosImportados.sistema || 'Cunha Reparos'}</p>
                                    ${dadosImportados.integridade ? `<p><strong style="color: #4CAF50;">üîí Checksum:</strong> ${dadosImportados.integridade.checksum}</p>` : ''}
                                </div>
                            </div>
                            
                            <!-- Compara√ß√£o de Dados -->
                            <div style="background: #1a1a1a; border: 2px solid #FF9800; border-radius: 10px; padding: 20px; margin: 20px 0; text-align: left;">
                                <h4 style="color: #FF9800; margin-top: 0; margin-bottom: 15px;">üìä Compara√ß√£o de Dados:</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; font-size: 0.85rem;">
                                    <div style="color: #ffd700; font-weight: 600; text-align: center;">Tipo</div>
                                    <div style="color: #f44336; font-weight: 600; text-align: center;">Atual</div>
                                    <div style="color: #4CAF50; font-weight: 600; text-align: center;">Novo</div>
                                    
                                    <div style="color: white;">üìã Or√ßamentos</div>
                                    <div style="color: #f44336; text-align: center;">${estatisticasAtuais.orcamentos}</div>
                                    <div style="color: #4CAF50; text-align: center;">${estatisticas.totalOrcamentos || dadosImportados.dados.orcamentos?.length || 0}</div>
                                    
                                    <div style="color: white;">üë§ Clientes</div>
                                    <div style="color: #f44336; text-align: center;">${estatisticasAtuais.clientes}</div>
                                    <div style="color: #4CAF50; text-align: center;">${estatisticas.totalClientes || dadosImportados.dados.clientes?.length || 0}</div>
                                    
                                    <div style="color: white;">üë• Colaboradores</div>
                                    <div style="color: #f44336; text-align: center;">${estatisticasAtuais.colaboradores}</div>
                                    <div style="color: #4CAF50; text-align: center;">${estatisticas.totalColaboradores || dadosImportados.dados.colaboradores?.length || 0}</div>
                                    
                                    <div style="color: white;">üí∏ Despesas</div>
                                    <div style="color: #f44336; text-align: center;">${estatisticasAtuais.despesas}</div>
                                    <div style="color: #4CAF50; text-align: center;">${estatisticas.totalDespesas || dadosImportados.dados.despesas?.length || 0}</div>
                                </div>
                                ${estatisticas.valorTotalVendas ? `
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #333;">
                                    <p style="color: white; margin: 0;"><strong style="color: #4CAF50;">üí∞ Total em Vendas do Backup:</strong> ${estatisticas.valorTotalVendas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>
                                    ${estatisticas.valorTotalDespesas ? `<p style="color: white; margin: 5px 0 0 0;"><strong style="color: #f44336;">üí∏ Total em Despesas do Backup:</strong> ${estatisticas.valorTotalDespesas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>` : ''}
                                </div>
                                ` : ''}
                            </div>
                            
                            <!-- Aviso de Substitui√ß√£o -->
                            <div style="background: #333; border: 2px solid #f44336; border-radius: 8px; padding: 15px; margin: 20px 0;">
                                <p style="color: #f44336; margin: 0; font-weight: 700; font-size: 1.1rem;">
                                    ‚ö†Ô∏è ATEN√á√ÉO: SUBSTITUI√á√ÉO COMPLETA DE DADOS!
                                </p>
                                <p style="color: #ccc; margin: 10px 0 0 0; font-size: 0.9rem;">
                                    ‚Ä¢ Todos os dados atuais ser√£o <strong>PERMANENTEMENTE PERDIDOS</strong><br>
                                    ‚Ä¢ Esta a√ß√£o <strong>N√ÉO PODE SER DESFEITA</strong><br>
                                    ‚Ä¢ Certifique-se de que este √© o backup correto
                                </p>
                            </div>
                            
                            <!-- Bot√µes de A√ß√£o -->
                            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px; flex-wrap: wrap;">
                                <button onclick="confirmarImportacao('${btoa(JSON.stringify(dadosImportados))}')" 
                                        style="background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%); color: white; border: none; padding: 15px 25px; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 1rem; box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3); transition: all 0.3s ease;" 
                                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(76, 175, 80, 0.4)'" 
                                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(76, 175, 80, 0.3)'">
                                    ‚úÖ CONFIRMAR IMPORTA√á√ÉO
                                </button>
                                <button onclick="cancelarImportacao()" 
                                        style="background: linear-gradient(135deg, #f44336 0%, #e57373 100%); color: white; border: none; padding: 15px 25px; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 1rem; box-shadow: 0 5px 15px rgba(244, 67, 54, 0.3); transition: all 0.3s ease;" 
                                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(244, 67, 54, 0.4)'" 
                                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(244, 67, 54, 0.3)'">
                                    ‚ùå CANCELAR
                                </button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(confirmacao);
                    
                } catch (error) {
                    console.error('‚ùå Erro ao processar arquivo:', error);
                    showNotification('‚ùå Erro ao ler o arquivo. Verifique se √© um arquivo JSON v√°lido do Cunha Reparos.', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('‚ùå Erro ao ler o arquivo. Tente novamente.', 'error');
            };
            
            reader.readAsText(arquivo, 'UTF-8');
        }

        // Fun√ß√£o para validar arquivo de importa√ß√£o
        function validarArquivoImportacao(dados) {
            try {
                // Verificar estrutura b√°sica
                if (!dados || typeof dados !== 'object') {
                    return { valido: false, erro: 'Arquivo n√£o √© um objeto JSON v√°lido!' };
                }
                
                if (!dados.dados || typeof dados.dados !== 'object') {
                    return { valido: false, erro: 'Estrutura de dados inv√°lida! Este n√£o √© um backup do Cunha Reparos.' };
                }
                
                if (!dados.sistema || !dados.sistema.includes('Cunha Reparos')) {
                    return { valido: false, erro: 'Este arquivo n√£o √© um backup v√°lido do sistema Cunha Reparos!' };
                }
                
                // Verificar se os arrays de dados existem
                const dadosEsperados = ['orcamentos', 'clientes', 'colaboradores', 'despesas'];
                for (const campo of dadosEsperados) {
                    if (!dados.dados[campo] || !Array.isArray(dados.dados[campo])) {
                        return { valido: false, erro: `Campo '${campo}' n√£o encontrado ou n√£o √© um array v√°lido!` };
                    }
                }
                
                // Validar integridade dos dados
                if (!validarIntegridadeDados(dados.dados)) {
                    return { valido: false, erro: 'Dados corrompidos ou incompletos detectados no backup!' };
                }
                
                // Verificar se h√° pelo menos alguns dados
                const totalRegistros = dados.dados.orcamentos.length + 
                                     dados.dados.clientes.length + 
                                     dados.dados.colaboradores.length + 
                                     dados.dados.despesas.length;
                
                if (totalRegistros === 0) {
                    return { valido: false, erro: 'O backup est√° vazio! N√£o h√° dados para importar.' };
                }
                
                return { valido: true };
                
            } catch (error) {
                console.error('Erro na valida√ß√£o do arquivo:', error);
                return { valido: false, erro: 'Erro interno na valida√ß√£o do arquivo. Verifique o formato.' };
            }
        }

        function confirmarImportacao(dadosBase64) {
            try {
                showNotification('üì• Iniciando importa√ß√£o completa dos dados...', 'info');
                
                const dadosImportados = JSON.parse(atob(dadosBase64));
                
                // Fazer backup dos dados atuais (em caso de erro)
                const backupAtual = {
                    orcamentos: [...orcamentos],
                    clientes: [...clientes],
                    colaboradores: [...colaboradores],
                    despesas: [...despesas]
                };
                
                // Valida√ß√£o final antes da importa√ß√£o
                const validacaoFinal = validarArquivoImportacao(dadosImportados);
                if (!validacaoFinal.valido) {
                    showNotification(`‚ùå Falha na valida√ß√£o final: ${validacaoFinal.erro}`, 'error');
                    cancelarImportacao();
                    return;
                }
                
                // Contador de registros importados
                let registrosImportados = {
                    orcamentos: 0,
                    clientes: 0,
                    colaboradores: 0,
                    despesas: 0
                };
                
                try {
                    // Importar or√ßamentos
                    if (dadosImportados.dados.orcamentos && Array.isArray(dadosImportados.dados.orcamentos)) {
                        orcamentos.length = 0; // Limpar array atual
                        orcamentos.push(...dadosImportados.dados.orcamentos);
                        registrosImportados.orcamentos = dadosImportados.dados.orcamentos.length;
                    }
                    
                    // Importar clientes
                    if (dadosImportados.dados.clientes && Array.isArray(dadosImportados.dados.clientes)) {
                        clientes.length = 0; // Limpar array atual
                        clientes.push(...dadosImportados.dados.clientes);
                        registrosImportados.clientes = dadosImportados.dados.clientes.length;
                    }
                    
                    // Importar colaboradores
                    if (dadosImportados.dados.colaboradores && Array.isArray(dadosImportados.dados.colaboradores)) {
                        colaboradores.length = 0; // Limpar array atual
                        colaboradores.push(...dadosImportados.dados.colaboradores);
                        registrosImportados.colaboradores = dadosImportados.dados.colaboradores.length;
                    }
                    
                    // Importar despesas
                    if (dadosImportados.dados.despesas && Array.isArray(dadosImportados.dados.despesas)) {
                        despesas.length = 0; // Limpar array atual
                        despesas.push(...dadosImportados.dados.despesas);
                        registrosImportados.despesas = dadosImportados.dados.despesas.length;
                    }
                    
                    // Validar dados ap√≥s importa√ß√£o
                    const dadosAposImportacao = {
                        orcamentos: orcamentos,
                        clientes: clientes,
                        colaboradores: colaboradores,
                        despesas: despesas
                    };
                    
                    if (!validarIntegridadeDados(dadosAposImportacao)) {
                        throw new Error('Dados corrompidos ap√≥s importa√ß√£o');
                    }
                    
                    // Fechar modais
                    cancelarImportacao();
                    closeModal('importar-dados');
                    
                    // Atualizar toda a interface
                    atualizarDashboard();
                    atualizarVendasUltimos6Meses();
                    atualizarTabelaOrcamentos();
                    atualizarSelectClientes();
                    
                    // Limpar formul√°rio
                    const formImportar = document.getElementById('form-importar-dados');
                    if (formImportar) {
                        formImportar.reset();
                    }
                    
                    // Calcular totais
                    const totalImportado = registrosImportados.orcamentos + 
                                         registrosImportados.clientes + 
                                         registrosImportados.colaboradores + 
                                         registrosImportados.despesas;
                    
                    // Notifica√ß√£o de sucesso
                    showNotification('‚úÖ IMPORTA√á√ÉO CONCLU√çDA COM SUCESSO! Todos os dados foram atualizados.', 'success');
                    
                    // Mostrar resumo detalhado da importa√ß√£o
                    setTimeout(() => {
                        const resumoDetalhado = `üìä RESUMO DA IMPORTA√á√ÉO: ${totalImportado} registros | ${registrosImportados.orcamentos} or√ßamentos | ${registrosImportados.clientes} clientes | ${registrosImportados.colaboradores} colaboradores | ${registrosImportados.despesas} despesas`;
                        showNotification(resumoDetalhado, 'info');
                    }, 2000);
                    
                    // Mostrar informa√ß√µes adicionais se dispon√≠veis
                    if (dadosImportados.estatisticas && dadosImportados.estatisticas.valorTotalVendas) {
                        setTimeout(() => {
                            const valorVendas = dadosImportados.estatisticas.valorTotalVendas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                            showNotification(`üí∞ Total em vendas importadas: ${valorVendas}`, 'info');
                        }, 4000);
                    }
                    
                    // Log detalhado para debug
                    console.log('‚úÖ IMPORTA√á√ÉO COMPLETA:', {
                        dataImportacao: new Date().toLocaleString('pt-BR'),
                        origem: {
                            sistema: dadosImportados.sistema,
                            versao: dadosImportados.versao,
                            dataExportacao: dadosImportados.dataExportacao
                        },
                        registrosImportados: registrosImportados,
                        totalRegistros: totalImportado,
                        checksum: dadosImportados.integridade?.checksum || 'N/A'
                    });
                    
                } catch (importError) {
                    // Restaurar backup em caso de erro durante a importa√ß√£o
                    console.error('‚ùå Erro durante importa√ß√£o, restaurando backup:', importError);
                    
                    orcamentos.length = 0;
                    orcamentos.push(...backupAtual.orcamentos);
                    
                    clientes.length = 0;
                    clientes.push(...backupAtual.clientes);
                    
                    colaboradores.length = 0;
                    colaboradores.push(...backupAtual.colaboradores);
                    
                    despesas.length = 0;
                    despesas.push(...backupAtual.despesas);
                    
                    // Atualizar interface com dados restaurados
                    atualizarDashboard();
                    atualizarVendasUltimos6Meses();
                    atualizarTabelaOrcamentos();
                    atualizarSelectClientes();
                    
                    throw importError; // Re-lan√ßar erro para ser capturado pelo catch externo
                }
                
            } catch (error) {
                console.error('‚ùå Erro cr√≠tico na importa√ß√£o:', error);
                showNotification('‚ùå ERRO NA IMPORTA√á√ÉO! Os dados foram restaurados ao estado anterior. Verifique o arquivo e tente novamente.', 'error');
                cancelarImportacao();
            }
        }

        function cancelarImportacao() {
            const modal = document.getElementById('modal-confirmacao-importacao');
            if (modal) {
                modal.remove();
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            atualizarDashboard();
            atualizarVendasUltimos6Meses(); // Inicializa o card de vendas
            atualizarTabelaOrcamentos();
            atualizarSelectClientes();
            
            // Definir data atual nos campos de data
            const hoje = new Date();
            hoje.setMinutes(hoje.getMinutes() - hoje.getTimezoneOffset());
            const dataAtual = hoje.toISOString().split('T')[0];
            
            const camposData = ['orcamento-data', 'despesa-data', 'data-pagamento-entrada-select', 'data-pagamento-saldo'];
            camposData.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (elemento) {
                    elemento.value = dataAtual;
                }
            });
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99562c0e2707cb59',t:'MTc2MTYwOTgyNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>